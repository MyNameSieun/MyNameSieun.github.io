---
title: "[Spring] ê¹€ì˜í•œ ìŠ¤í”„ë§ ê¸°ë³¸ ì •ë¦¬ #5 - ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ"
categories: [Spring]
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "counts"
---

<br>

# 1. ì›¹ ì• í”Œë¦¬ì¼€ì•„ì…˜ê³¼ ì‹±ê¸€í†¤

> ìŠ¤í”„ë§ì€ ê¸°ì—…ìš© ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ ê¸°ìˆ ì„ ì§€ì›í•˜ê¸° ìœ„í•´ íƒ„ìƒí–ˆë‹¤.

ëŒ€ë¶€ë¶„ì˜ ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë©°, ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë³´í†µ ì—¬ëŸ¬ ê³ ê°ì´ ë™ì‹œì— ìš”ì²­ì„ í•œë‹¤.

![](/assets/images/2025/2025-02-16-08-05-16.png)

<br>

- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ìš”ì²­í•˜ê¸° ë•Œë¬¸ì— ê°ì²´ë¥¼ ë§¤ë²ˆ ìƒì„±í•˜ë©´ ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ì‹¬í•˜ë‹¤.
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê°ì²´ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•˜ê³  ê³µìœ í•˜ëŠ” ë°©ì‹(ì‹±ê¸€í†¤ íŒ¨í„´)ì„ ì‚¬ìš©í•œë‹¤.

<br>

> ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆì˜ ë¬¸ì œì 

`test/hello.core`ì— `singleton` íŒ¨í‚¤ì§€ ìƒì„± í›„, `SingletonTest` ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì.

```java
package hello.core.singleton;

import hello.core.AppConfig;
import hello.core.member.MemberService;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.*;

public class SingletonTest {
    @Test
    @DisplayName("ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆ")

    void pureContainer(){
        AppConfig appConfig = new AppConfig();

        //1. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±
        MemberService memberService1 = appConfig.memberService();

        //2. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±
        MemberService memberService2 = appConfig.memberService();

        //ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ ê²ƒì„ í™•ì¸
        System.out.println("memberService1 = " + memberService1);
        System.out.println("memberService2 = " + memberService2);

        //memberService1 != memberService2
        assertThat(memberService1).isNotSameAs(memberService2);

    }
}
```

![](/assets/images/2025/2025-02-16-08-10-29.png)

- ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆì¸ AppConfigëŠ” ìš”ì²­ì„ í•  ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒˆë¡œ ìƒì„±í•œë‹¤.
- ê³ ê° íŠ¸ë˜í”½ì´ ì´ˆë‹¹ 100ì´ ë‚˜ì˜¤ë©´ ì´ˆë‹¹ 100ê°œ ê°ì²´ê°€ ìƒì„±ë˜ê³  ì†Œë©¸ëœë‹¤. -> ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ì‹¬í•˜ë‹¤.
- í•´ê²° ë°©ë²•: ì‹±ê¸€í†¤ íŒ¨í„´ ì ìš©í•˜ì—¬ í•´ë‹¹ ê°ì²´ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ê³ , ê³µìœ í•˜ë„ë¡ ì„¤ê³„í•˜ë©´ ëœë‹¤.

<br><br>

# 2. ì‹±ê¸€í†¤ íŒ¨í„´

> ì‹±ê¸€í†¤ íŒ¨í„´ì´ë€, í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì´ë‹¤.

- ê·¸ë˜ì„œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ 2ê°œ ì´ìƒ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ì•„ì•¼ í•œë‹¤.
- private ìƒì„±ìë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë¶€ì—ì„œ ì„ì˜ë¡œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ì•„ì•¼ í•œë‹¤.

> ìœ„ ì½”ë“œë¥¼ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•˜ì—¬ í•´ê²°í•´ë³´ì.

`test/hello.core/singleton`ì— `SingletonService` ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì.

```java
package hello.core.singleton;

public class SingletonService {
    // 1. static ì˜ì—­ì— ê°ì²´ë¥¼ ë”± 1ê°œë§Œ ìƒì„±í•´ë‘”ë‹¤.
    private static final SingletonService instance = new SingletonService();

    // 2. publicìœ¼ë¡œ ì—´ì–´ì„œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì´ static ë©”ì„œë“œë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒí•˜ë„ë¡ í—ˆìš©í•œë‹¤.
    public static SingletonService getInstance() {
        return instance; // í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜
    }

    // 3. ìƒì„±ìë¥¼ privateìœ¼ë¡œ ì„ ì–¸í•´ì„œ ì™¸ë¶€ì—ì„œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ê°ì²´ ìƒì„±ì„ ëª»í•˜ê²Œ ë§‰ëŠ”ë‹¤.
    private SingletonService() {
    }

    public void logic() {
        System.out.println("ì‹±ê¸€í†¤ ê°ì²´ ë¡œì§ í˜¸ì¶œ");
    }
}
```

- ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•˜ë©´ ê°ì²´ê°€ ë‹¨ í•˜ë‚˜ë§Œ ìƒì„±ë˜ê³  ê³µìœ ëœë‹¤.
- static ì˜ì—­ì— ê°ì²´ instanceë¥¼ ë¯¸ë¦¬ í•˜ë‚˜ ìƒì„±í•´ì„œ ì˜¬ë ¤ë‘”ë‹¤.
- new í‚¤ì›Œë“œë¡œ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë„ë¡ ìƒì„±ìë¥¼ **privateìœ¼ë¡œ ë§‰ëŠ”ë‹¤**.â­
- `getInstance()` ë©”ì„œë“œë¥¼ í†µí•´ì„œë§Œ ê°ì²´ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤. ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.

<br>

> ì•„ê¹Œ ìƒì„±í•œ `SingletonTest` ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€ë¡œ ì‘ì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì.

```java
  @Test
    @DisplayName("ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•œ ê°ì²´ ì‚¬ìš©")
    void singletonServiceTest(){
        SingletonService singletonService1 = SingletonService.getInstance();
        SingletonService singletonService2 = SingletonService.getInstance();

        //ì°¸ì¡°ê°’ì´ ê°™ì€ ê²ƒì„ í™•ì¸
        System.out.println("singletonService1 = " + singletonService1);
        System.out.println("singletonService2 = " + singletonService2);

        // singletonService1 == singletonService2
        assertThat(singletonService1).isSameAs(singletonService2);

        singletonService1.logic();
    }
```

ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

![](/assets/images/2025/2025-02-16-08-21-36.png)

<br>

> ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì 

- ì½”ë“œê°€ ë³µì¡: ì‹±ê¸€í†¤ì„ êµ¬í˜„í•˜ëŠ” ì½”ë“œê°€ ë§ì•„ì§
- DIP, OCP ì›ì¹™ ìœ„ë°˜: êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•˜ê²Œ ë¨ â†’ í™•ì¥ì„±ì´ ë‚®ìŒ
- í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ì›€: ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ì–´ í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ì›Œì§
- ê²°ë¡ ì ìœ¼ë¡œ ìœ ì—°ì„±ì´ ë–¨ì–´ì ¸ ì•ˆí‹°íŒ¨í„´ìœ¼ë¡œ ë¶ˆë¦¬ê¸°ë„ í•œë‹¤.

ğŸ’¡ ë”°ë¼ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„ì™€ ê°™ì€ ë¬¸ì œì ì„ í•´ê²°í•œë‹¤.

<br><br>

# 3. ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ

> ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ë©´ì„œ, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤(1ê°œë§Œ ìƒì„±)ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í„´ íŒ¨í„´ì„ ì ìš©í•˜ì§€ ì•Šì•„ë„, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.
- **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•œë‹¤.** ì´ë ‡ê²Œ ì‹±ê¸€í†¤ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¼ í•œë‹¤.
  - ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ í•™ìŠµí•œ ìŠ¤í”„ë§ ë¹ˆì´ ë°”ë¡œ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ” ë¹ˆì´ë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì´ëŸ° ê¸°ëŠ¥ ë•ë¶„ì— ì‹±ê¸€í„´ íŒ¨í„´ì˜ ëª¨ë“  ë‹¨ì ì„ í•´ê²°í•˜ë©´ì„œ ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.
  - ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìœ„í•œ ì§€ì €ë¶„í•œ ì½”ë“œê°€ ë“¤ì–´ê°€ì§€ ì•Šì•„ë„ ëœë‹¤.
  - DIP, OCP, í…ŒìŠ¤íŠ¸, private ìƒì„±ìë¡œë¶€í„° ììœ ë¡­ê²Œ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

<br>

> ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ

ì•„ê¹Œ ìƒì„±í•œ `SingletonTest` ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€ë¡œ ì‘ì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì.

```java
    @Test
    @DisplayName("ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ì‹±ê¸€í†¤")
    void springContainer(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);


        MemberService memberService1 = ac.getBean("memberService", MemberService.class);
        MemberService memberService2 = ac.getBean("memberService", MemberService.class);

        //ì°¸ì¡°ê°’ì´ ê°™ì€ ê²ƒì„ í™•ì¸
        System.out.println("memberService1 = " + memberService1);
        System.out.println("memberService2 = " + memberService2);

        //memberService1 == memberService2
        assertThat(memberService1).isSameAs(memberService2);
    }
```

ë³´ë‹¤ì‹œí”¼ ì‹±ê¸€í†¤ íŒ¨í„´ê³¼ ê´€ë ¨ëœ ì½”ë“œê°€ ë“¤ì–´ìˆì§€ ì•Šì§€ë§Œ, ì‹±ê¸€í†¤ì´ ì ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](/assets/images/2025/2025-02-16-08-37-38.png)

<br>

![](/assets/images/2025/2025-02-16-08-36-48.png)

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ë•ë¶„ì— ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê°ì²´ë¥¼ ê³µìœ í•´ì„œ
  íš¨ìœ¨ì ìœ¼ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ìŠ¤í”„ë§ì˜ ê¸°ë³¸ ë¹ˆ ë“±ë¡ ë°©ì‹ì€ ì‹±ê¸€í†¤ì´ë‹¤. ê±°ì˜ 99.9%ëŠ” ì‹±ê¸€í†¤ ë¹ˆë§Œ ì‚¬ìš©í•œë‹¤.
- í•˜ì§€ë§Œ, ìš”ì²­í•  ë•Œ ë§ˆë‹¤ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ë„ ì œê³µí•œë‹¤.

<br><br>

# 4. ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì â­â­

> ì‹±ê¸€í†¤ ê°ì²´ëŠ” ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì—, ìƒíƒœë¥¼ ìœ ì§€(stateful)í•˜ë©´ ì•ˆ ëœë‹¤.

- ë¬´ìƒíƒœ(Stateless) ì„¤ê³„ í•„ìˆ˜!
  - íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì— ì˜ì¡´ì ì¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆ ë¨
  - ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œë¥¼ ë§Œë“¤ë©´ ì•ˆ ë¨
  - ê°€ê¸‰ì  ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„
  - í•„ë“œ ëŒ€ì‹ ì— ìë°”ì—ì„œ ê³µìœ ë˜ì§€ ì•ŠëŠ”, ì§€ì—­ ë³€ìˆ˜, íŒŒë¼ë¯¸í„°, ThreadLocalì„ ì‚¬ìš©í•´ì•¼ í•¨

â­ ìŠ¤í”„ë§ ë¹ˆì˜ í•„ë“œì— ê³µìœ  ê°’ì„ ì„¤ì •í•˜ë©´ ì •ë§ í° ì¥ì• ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

<br>

`test/hello.core/singleton`ì— `StatefulService` ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì.

> ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ì˜ëª»ëœ ì˜ˆì œ

```java
public class StatefulService {
    private int price; // ìƒíƒœ ìœ ì§€í•˜ëŠ” í•„ë“œ (ë¬¸ì œ ë°œìƒ)

    public void order(String name, int price) {
        System.out.println("name = " + name + " price = " + price);
        this.price = price; // ë‹¤ë¥¸ ì‚¬ìš©ì ìš”ì²­ ì‹œ ê°’ì´ ë®ì–´ì”Œì›Œì§
    }

    public int getPrice() {
        return price;
    }
}
```

ê·¸ í›„, í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë§Œë“¤ì. ì•„ë˜ ë‹¨ì¶•í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ Test íŒŒì¼ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

- Window: Ctrl + Shift + T
- Mac: Command + T

![](/assets/images/2025/2025-02-16-08-45-26.png)

```java
package hello.core.singleton;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;

public class StatefulServiceTest {

    @Test
    void statefulServiceSingleton() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);

        StatefulService statefulService1 = ac.getBean("statefulService", StatefulService.class);
        StatefulService statefulService2 = ac.getBean("statefulService", StatefulService.class);

        // ThreadA: Aì‚¬ìš©ì 10000ì› ì£¼ë¬¸
        statefulService1.order("userA", 10000);

        // ThreadB: Bì‚¬ìš©ì 20000ì› ì£¼ë¬¸
        statefulService2.order("userB", 20000);

        // ThreadA: ì‚¬ìš©ìA ì£¼ë¬¸ ê¸ˆì•¡ ì¡°íšŒ
        int price = statefulService1.getPrice();

        // ThreadA: ì‚¬ìš©ìAëŠ” 10000ì›ì„ ê¸°ëŒ€í–ˆì§€ë§Œ, ê¸°ëŒ€ì™€ ë‹¤ë¥´ê²Œ 20000ì› ì¶œë ¥
        System.out.println("price = " + price);

        Assertions.assertThat(statefulService1.getPrice()).isEqualTo(20000);
    }

    static class TestConfig {
        @Bean
        public StatefulService statefulService() {
            return new StatefulService();
        }
    }
}
```

![](/assets/images/2025/2025-02-16-08-49-49.png)

<br>

> í•´ê²° ë°©ë²•

- í•„ë“œë¥¼ ì œê±°í•˜ê³ , ì§€ì—­ ë³€ìˆ˜ ë˜ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì²˜ë¦¬
- â­â­ ì§„ì§œ ê³µìœ í•„ë“œëŠ” ì¡°ì‹¬í•´ì•¼ í•œë‹¤! ìŠ¤í”„ë§ ë¹ˆì€ í•­ìƒ ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•˜ì.

```java
package hello.core.singleton;

public class StatefulService {
    // private int price; // ìƒíƒœ ìœ ì§€í•˜ëŠ” í•„ë“œ (ë¬¸ì œ ë°œìƒ)

    public int order(String name, int price) {
        System.out.println("name = " + name + " price = " + price);
        // this.price = price; // ë‹¤ë¥¸ ì‚¬ìš©ì ìš”ì²­ ì‹œ ê°’ì´ ë®ì–´ì”Œì›Œì§
        return price; // í•„ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì£¼ë¬¸í•œ ê¸ˆì•¡ì„ ë°˜í™˜
    }
}
```

```java
package hello.core.singleton;

import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;

public class StatefulServiceTest {

    @Test
    void statefulServiceSingleton() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);

        StatefulService statefulService1 = ac.getBean("statefulService", StatefulService.class);
        StatefulService statefulService2 = ac.getBean("statefulService", StatefulService.class);

        // ThreadA: Aì‚¬ìš©ì 10000ì› ì£¼ë¬¸
        int userAPrice = statefulService1.order("userA", 10000);

        // ThreadB: Bì‚¬ìš©ì 20000ì› ì£¼ë¬¸
        int userBPrice = statefulService2.order("userB", 20000);

        // ThreadA: ì‚¬ìš©ìA ì£¼ë¬¸ ê¸ˆì•¡ ì¡°íšŒ
        // int price = statefulService1.getPrice();
        System.out.println("price = "+ userAPrice);
    }

    static class TestConfig {
        @Bean
        public StatefulService statefulService() {
            return new StatefulService();
        }
    }
}
```

<br><br>

# 5. @Configurationê³¼ ì‹±ê¸€í†¤

> ì•„ë˜ AppConfig ì½”ë“œë¥¼ ë³´ì.

- memberServiceê³¼ orderServiceì„ ë§Œë“œëŠ” ì½”ë“œì—ì„œ `memberRepository()` ë¥¼ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œí•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¸ë‹¤.
- ê°ê° ë‹¤ë¥¸ `MemoryMemberRepository`ê°€ ìƒì„±ë˜ë©´ì„œ, ì‹±ê¸€í†¤ì´ ê¹¨ì§€ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¸ë‹¤.

```java
@Configuration
public class AppConfig {
    @Bean
    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }

    @Bean
    public OrderService orderService() {
        return new OrderServiceImpl(memberRepository(), discountPolicy());
    }

    @Bean
    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }
}
```

<br>

> ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ? ì§ì ‘ ê²€ì¦í•´ë³´ì.

`MemberServiceImpl`ì— í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€

```java
package hello.core.member;


public class MemberServiceImpl implements MemberService{

    private final MemberRepository memberRepository;

    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }

    // í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ ìš©ë„)
    public MemberRepository getMemberRepository(){
        return memberRepository;
    }

}
```

<br>

`OrderServiceImpl`ì— í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€

```java
package hello.core.order;

import hello.core.discount.DiscountPolicy;
import hello.core.member.Member;
import hello.core.member.MemberRepository;

public class OrderServiceImpl implements OrderService{

    private MemberRepository memberRepository;
    private DiscountPolicy discountPolicy;

    // ìƒì„±ì
    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);

        return new Order(memberId, itemName, itemPrice, discountPrice);
    }

    // í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ ìš©ë„)
    public MemberRepository getMemberRepository(){
        return memberRepository;
    }
}
```

<br>

`test/hello.core/singleton`ì— `ConfigurationSingletonTest` í´ë˜ìŠ¤ ìƒì„±

```java
package hello.core.singleton;

public class ConfigurationSingletonTest {
    @Test
    void configurationTest(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

        MemberServiceImpl memberService = ac.getBean("memberService", MemberServiceImpl.class);
        OrderServiceImpl orderService = ac.getBean("orderService", OrderServiceImpl.class);
        MemberRepository memberRepository = ac.getBean("memberRepository", MemberRepository.class);

        MemberRepository memberRepository1 = memberService.getMemberRepository();
        MemberRepository memberRepository2 = orderService.getMemberRepository();

        //ëª¨ë‘ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ê³ í•˜ê³  ìˆë‹¤.
        System.out.println("memberService -> memberRepository = " + memberRepository1);
        System.out.println("orderService -> memberRepository = " + memberRepository2);
        System.out.println("memberRepository = " + memberRepository);

        Assertions.assertThat(memberService.getMemberRepository()).isSameAs(memberRepository);
        Assertions.assertThat(orderService.getMemberRepository()).isSameAs(memberRepository);
    }
}
```

![](/assets/images/2025/2025-02-17-07-30-22.png)

> AppConfigì˜ ìë°” ì½”ë“œë¥¼ ë³´ë©´ ë¶„ëª…íˆ ê°ê° 2ë²ˆ ` new MemoryMemberRepository` í˜¸ì¶œí•´ì„œ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ì–´ì•¼ í•˜ëŠ”ë°, í™•ì¸í•´ë³´ë©´ ëª¨ë‘ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•˜ì—¬ ì¡°íšŒí•˜ê³  ìˆë‹¤.

ì´ê²Œ ì–´ë–»ê²Œ ê°€ëŠ¥í•œ ì¼ì¼ê¹Œ? ì‹¤í—˜ì„ í†µí•´ ì•Œì•„ë³´ì.

<br>

`AppConfig`ì— í˜¸ì¶œ ë¡œê·¸ ë‚¨ê¹€

```java
package hello.core;

import hello.core.discount.DiscountPolicy;
import hello.core.discount.RateDiscountPolicy;
import hello.core.member.MemberRepository;
import hello.core.member.MemberService;
import hello.core.member.MemberServiceImpl;
import hello.core.member.MemoryMemberRepository;
import hello.core.order.OrderService;
import hello.core.order.OrderServiceImpl;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {

    @Bean
    public MemberService memberService() {
        // 1ë²ˆ
        System.out.println("call AppConfig.memberService");
        return new MemberServiceImpl(memberRepository());
    }

    @Bean
    public OrderService orderService() {
        // 1ë²ˆ
        System.out.println("call AppConfig.orderService");
        return new OrderServiceImpl(memberRepository(), discountPolicy());
    }

    @Bean
    public MemberRepository memberRepository() {
        // 2ë²ˆ? 3ë²ˆ?
        System.out.println("call AppConfig.memberRepository");
        return new MemoryMemberRepository();
    }

    @Bean
    public DiscountPolicy discountPolicy() {
        return new RateDiscountPolicy();
    }
}
```

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ê°ê° @Beanì„ í˜¸ì¶œí•´ì„œ ìŠ¤í”„ë§ ë¹ˆì„ ìƒì„±í•˜ê¸° ë•Œë¬¸ì—, ì˜ˆìƒëŒ€ë¡œë¼ë©´ `memberRepository()`ì€ ì•„ë˜ì™€ ê°™ì´ 3ë²ˆ í˜¸ì¶œë˜ì•¼ í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¸ë‹¤.

  1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•˜ê¸° ìœ„í•´ @Beanì´ ë¶™ì–´ìˆëŠ” `memberRepository()` í˜¸ì¶œ
  2. memberService() ë¡œì§ì—ì„œ `memberRepository()` í˜¸ì¶œ
  3. orderService() ë¡œì§ì—ì„œ `memberRepository()` í˜¸ì¶œ

<br>

> ê·¸ëŸ°ë° ì¶œë ¥ ê²°ê³¼ëŠ” ëª¨ë‘ 1ë²ˆë§Œ í˜¸ì¶œë˜ëŠ”ë°, ê·¸ ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

![](/assets/images/2025/2025-02-17-07-42-35.png)

- `memberRepository()`ê°€ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ì„ ë³´ì¥í•œë‹¤.
- `@Configurationì„` ì‚¬ìš©í•˜ë©´ **CGLIB(ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ ê¸°ìˆ )** ì„ ì´ìš©í•˜ì—¬ ì‹±ê¸€í†¤ì„ ë³´ì¥í•œë‹¤.

<br><br>

# 6. @Configurationê³¼ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì˜ ë§ˆë²•

> ìŠ¤í”„ë§ì€ ì‹±í´í†¤ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ í´ë˜ìŠ¤ì˜ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.

ëª¨ë“  ë¹„ë°€ì€ `@Configuration`ì„ ì ìš©í•œ `AppConfig`ì— ìˆë‹¤.

```java
    @Test
    void configurationDeep(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

        //AppConfigë„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤. (AnnotationConfigApplicationContextì— íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸´ ê°’ì€ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ê¸° ë•Œë¬¸)
        AppConfig been = ac.getBean(AppConfig.class);

        System.out.println("been = " + been.getClass());
         //ì¶œë ¥: bean = class hello.core.AppConfig$$SpringCGLIB$$0

    }
```

ìˆœìˆ˜í•œ í´ë˜ìŠ¤ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ë˜ì–´ì•¼ í•œë‹¤.

`class hello.core.AppConfig`

<br>

ê·¸ëŸ°ë° ì˜ˆìƒê³¼ëŠ” ë‹¤ë¥´ê²Œ í´ë˜ìŠ¤ ëª…ì— xxxCGLIBê°€ ë¶™ìœ¼ë©´ì„œ ìƒë‹¹íˆ ë³µì¡í•´ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ì´ê²ƒì€ ë‚´ê°€ ë§Œë“  í´ë˜ìŠ¤ê°€ ì•„ë‹ˆë¼ ìŠ¤í”„ë§ì´ CGLIBë¼ëŠ” ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ AppConfig í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ì„ì˜ì˜ ë‹¤
ë¥¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ê·¸ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œ ê²ƒì´ë‹¤.

![](/assets/images/2025/2025-02-17-07-49-59.png)

![](/assets/images/2025/2025-02-17-07-52-27.png)

ê·¸ ì„ì˜ì˜ ë‹¤ë¥¸ í´ë˜ìŠ¤ê°€ ë°”ë¡œ ì‹±ê¸€í†¤ì´ ë³´ì¥ë˜ë„ë¡ í•´ì¤€ë‹¤. ì•„ë§ˆë„ ë‹¤ìŒê³¼ ê°™ì´ ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì¡°ì‘í•´ì„œ ì‘ì„±ë˜ì–´ ìˆì„
ê²ƒì´ë‹¤.(ì‹¤ì œë¡œëŠ” CGLIBì˜ ë‚´ë¶€ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ëŠ”ë° ë§¤ìš° ë³µì¡í•˜ë‹¤ê³  í•œë‹¤.)

```java
@Bean
public MemberRepository memberRepository() {
    // ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì´ë¯¸ ë“±ë¡ëœ ë¹ˆì´ ìˆëŠ”ì§€ í™•ì¸
    if (memoryMemberRepositoryê°€ ì´ë¯¸ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´?) {
        return ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì°¾ì•„ì„œ ë°˜í™˜;
    }

    // ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì—†ìœ¼ë©´
    ê¸°ì¡´ ë¡œì§ì„ í˜¸ì¶œí•´ì„œ MemoryMemberRepositoryë¥¼ ìƒì„±í•˜ê³  ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡
    return ë°˜í™˜;
}
```

@Beanì´ ë¶™ì€ ë©”ì„œë“œë§ˆë‹¤ ì´ë¯¸ ìŠ¤í”„ë§ ë¹ˆì´ ì¡´ì¬í•˜ë©´ ì¡´ì¬í•˜ëŠ” ë¹ˆì„ ë°˜í™˜í•˜ê³ , ìŠ¤í”„ë§ ë¹ˆì´ ì—†ìœ¼ë©´ ìƒì„±í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ë°˜í™˜í•˜ëŠ” ì½”ë“œê°€ ë™ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤.

ë•ë¶„ì— ì‹±ê¸€í†¤ì´ ë³´ì¥ë˜ëŠ” ê²ƒì´ë‹¤.

<br>

> `@Configuration`ì„ ì ìš©í•˜ì§€ ì•Šê³ , `@Bean`ë§Œ ì ìš©í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

- @Beanë§Œ ì‚¬ìš©í•´ë„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤.
- í•˜ì§€ë§Œ, `@Bean` ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ê°ì²´ê°€ ìƒì„±ëœë‹¤. â†’ ì‹±ê¸€í†¤ ê¹¨ì§
- ë”°ë¼ì„œ ìŠ¤í”„ë§ ì„¤ì • ì •ë³´ëŠ” í•­ìƒ `@Configuration`ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

<br>

> ì •ë¦¬

| ê°œë…                | ì„¤ëª…                                                              |
| ------------------- | ----------------------------------------------------------------- |
| **ì‹±ê¸€í†¤ íŒ¨í„´**     | ê°ì²´ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•˜ê³  ê³µìœ í•˜ëŠ” ë””ìì¸ íŒ¨í„´                       |
| **ë¬¸ì œì **          | ì½”ë“œ ë³µì¡, DIP/OCP ìœ„ë°˜, í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€, ë©€í‹°ì“°ë ˆë“œ ì´ìŠˆ ë°œìƒ ê°€ëŠ¥ |
| **ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ** | ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ì‹±ê¸€í†¤ ê°ì²´ë¥¼ ê´€ë¦¬ (`ApplicationContext`)       |
| **ì£¼ì˜ì **          | ì‹±ê¸€í†¤ ê°ì²´ëŠ” **ë¬´ìƒíƒœ(stateless)**ë¡œ ì„¤ê³„í•´ì•¼ í•¨                 |
| **@Configuration**  | CGLIBì„ ì‚¬ìš©í•´ ì‹±ê¸€í†¤ì„ ë³´ì¥ (í•„ìˆ˜ ì ìš©)                          |

<br>
