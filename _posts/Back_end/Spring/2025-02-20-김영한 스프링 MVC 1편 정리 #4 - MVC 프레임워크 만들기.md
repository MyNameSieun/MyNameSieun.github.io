---
title: "[Spring] 김영한 스프링 MVC 1편 정리 #4 - MVC 프레임워크 만들기"
categories: [Spring]
toc: true
toc_sticky: true
author_profile: true
published: false

sidebar:
  nav: "counts"
---

<br>

- 단계적으로 MVC 프레임워크를 업그레이드 시켜보자.
- 마지막엔 스프링 MVC랑 유사한 구조로 궁극적으로 발전한다.
  {: .notice--danger}

<br>

# 1. 프론트 컨트롤러 패턴 소개

> 프론트 컨트롤러 도입 전

![](/assets/images/2025/2025-02-25-11-53-55.png)

공통로직(e.g., view로 이동)을 모두 컨트롤러마다 작성해야 한다.

<br>

> 프론트 컨트롤러 도입 후

![](/assets/images/2025/2025-02-25-11-54-46.png)

- **프론트 컨트롤러 서블릿** 하나로 클라이언트의 요청을 받고, 프론트 컨트롤러가 요청에 맞는 컨트롤러를 찾아서 호출한다.
- 즉, 입구를 하나로 하여 공통 처리가 가능하다.
- 프론트 컨트롤러를 제외한 나머지 컨트롤러는 서블릿을 사용하지 않아도 된다.
  - 서블릿 컨테이너가 직접 호출해주기 때문이다.

<br>

> 스프링 웹 MVC와 프론트 컨트롤러

- 스프링 웹 MVC의 핵심은 바로 **FrontController**이다.
- 스프링 웹 MVC의 **DispatcherServlet**이 FrontController 패턴으로 구현되어 있기 때문이다.

<br><br>

# 2. 프론트 컨트롤러 도입 - v1

> 프론트 컨트롤러를 단계적으로 도입해보자.

이번 목표는 기존 코드를 최대한 유지하면서, 프론트 컨트롤러를 도입하는 것이다.

먼저 구조를 맞추어두고 점진적으로 리펙터링 해보자.

<br>

> V1 구조

![](/assets/images/2025/2025-02-25-11-57-01.png)

<br>

## 2.1 컨트롤러 인터페이스 도입

> 스프링의 다형성을 적극 활용하여 서블릿과 비슷한 모양의 컨트롤러 인터페이스를 도입하자.

`hello.servlet.web.frontcontroller.v1`에 `ControllerV1` 인터페이스 생성

```java
package hello.servlet.web.frontcontroller.v1;

public interface ControllerV1 {
    void process(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException;
}
```

- 각 컨트롤러들은 이 인터페이스를 구현하면 된다. 프론트 컨트롤러는 이 인터페이스를 호출해서 구현과 관계없이 로직의 일관성을 가져갈 수 있다.
- 이제 이 인터페이스를 구현한 컨트롤러를 만들어보자. 지금 단계에서는 기존 로직을 최대한 유지하는게 핵심이다.

<br>

## 2.2 회원 등록 컨트롤러

> MemberFormControllerV1 - 회원 등록 컨트롤러

`hello.servlet.web.frontcontroller.v1.controller`에 `MemberFormControllerV1` 클래스 생성

```java
package hello.servlet.web.frontcontroller.controller;

public class MemberFormControllerV1 implements ControllerV1 {
    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String viewPath = "/WEB-INF/views/new-form.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}
```

<br>

## 2.3 회원 저장 컨트롤러

> MemberSaveControllerV1 - 회원 저장 컨트롤러

`hello.servlet.web.frontcontroller.v1.controlle`에 `MemberSaveControllerV1` 클래스 생성

```java
package hello.servlet.web.frontcontroller.controller;

public class MemberSaveControllerV1 implements ControllerV1
{
    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // 요청 파라미터에서 값 추출
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        // Member 객체 생성 및 저장
        Member member = new Member(username, age);
        System.out.println("member = " + member);
        memberRepository.save(member);

        // Model에 데이터 저장
        request.setAttribute("member", member);

        // View 경로 설정
        String viewPath = "/WEB-INF/views/save-result.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);

        // JSP로 포워딩
        dispatcher.forward(request, response);
    }
}
```

<br>

## 2.4 회원 목록 컨트롤러

> MemberListControllerV1 - 회원 목록 컨트롤러

`hello.servlet.web.frontcontroller.v1.controller`에 `MemberListControllerV1` 클래스 생성

```java
package hello.servlet.web.frontcontroller.v1.controller;

public class MemberListControllerV1 implements ControllerV1 {
    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        List<Member> members = memberRepository.findAll();

        request.setAttribute("members", members);

        String viewPath = "/WEB-INF/views/members.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}
```

내부 로직은 기존 서블릿과 거의 같다. 이제 프론트 컨트롤러를 만들어보자.

<br>

## 2.5 프론트 컨트롤러

> FrontControllerServletV1 - 프론트 컨트롤러

`hello.servlet.web.frontcontroller.v1`에 `FrontControllerServletV1` 클래스 생성

![](/assets/images/2025/2025-02-25-17-42-20.png)

```java
package hello.servlet.web.frontcontroller.v1;
import hello.servlet.web.frontcontroller.v1.controller.MemberFormControllerV1;
import hello.servlet.web.frontcontroller.v1.controller.MemberListControllerV1;
import hello.servlet.web.frontcontroller.v1.controller.MemberSaveControllerV1;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
@WebServlet(name = "frontControllerServletV1", urlPatterns = "/front-controller/
v1/*")
public class FrontControllerServletV1 extends HttpServlet {
 private Map<String, ControllerV1> controllerMap = new HashMap<>();
 public FrontControllerServletV1() {
 controllerMap.put("/front-controller/v1/members/new-form", new
MemberFormControllerV1());
 controllerMap.put("/front-controller/v1/members/save", new
MemberSaveControllerV1());
 controllerMap.put("/front-controller/v1/members", new
MemberListControllerV1());
 }
 @Override
 protected void service(HttpServletRequest request, HttpServletResponse
response)
 throws ServletException, IOException {
 System.out.println("FrontControllerServletV1.service");
 String requestURI = request.getRequestURI();
 ControllerV1 controller = controllerMap.get(requestURI);
 if (controller == null) {
 response.setStatus(HttpServletResponse.SC_NOT_FOUND);
 return;
 }
 controller.process(request, response);
 }
}
```

<br>

> 실행

- 등록: [http://localhost:8080/front-controller/v1/members/new-form](http://localhost:8080/front-controller/v1/members/new-form)
- 목록: [http://localhost:8080/front-controller/v1/members](http://localhost:8080/front-controller/v1/members)

기존 서블릿, JSP로 만든 MVC와 동일하게 실행 되는 것을 확인할 수 있다.

<br>

### 2.5.1 프론트 컨트롤러 분석

> urlPatterns

- `urlPatterns = "/front-controller/v1/*"` : `/front-controller/v1` 를 포함한 하위 모든 요청은 이 서블릿에서 받아들인다.
- 예) `/front-controller/v1` , `/front-controller/v1/a` , `/front-controller/v1/a/b`

<br>

> controllerMap

- key: 매핑 URL
- value: 호출될 컨트롤러

<br>

> service()

- 먼저 `requestURI` 를 조회해서 실제 호출할 컨트롤러를 `controllerMap` 에서 찾는다. 만약 없다면 404(SC_NOT_FOUND) 상태 코드를 반환한다.
- 컨트롤러를 찾고 `controller.process(request, response);` 을 호출해서 해당 컨트롤러를 실행한다.

<br>

> JSP

JSP는 이전 MVC에서 사용했던 것을 그대로 사용한다.

<br><br>

# 3. View 분리 - v2

> 모든 컨트롤러에서 뷰로 이동하는 부분에 중복이 있고, 깔끔하지 않다.

```java
String viewPath = "/WEB-INF/views/new-form.jsp";
RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
dispatcher.forward(request, response);
```

이 부분을 깔끔하게 분리하기 위해 별도로 뷰를 처리하는 객체를 만들자.

<br>

## V2 구조

![](/assets/images/2025/2025-02-25-12-03-19.png)

<br>

## MyView

> 뷰 객체는 이후 다른 버전에서도 함께 사용하므로 패키지 위치를 `frontcontroller` 에 두었다.

```java
package hello.servlet.web.frontcontroller;
import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
public class MyView {
 private String viewPath;
 public MyView(String viewPath) {
 this.viewPath = viewPath;
 }
 public void render(HttpServletRequest request, HttpServletResponse response)
throws ServletException, IOException {
 RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
 dispatcher.forward(request, response);
 }
}
```

이 코드만 봐서는 어떻게 활용하는지 아직 감이 안올 것이다. 다음 버전의 컨트롤러 인터페이스를 만들어보자. 컨트롤러가 뷰를 반환하는 특징이 있다.

<br>

## ControllerV2

```java
package hello.servlet.web.frontcontroller.v2;
import hello.servlet.web.frontcontroller.MyView;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
public interface ControllerV2 {
 MyView process(HttpServletRequest request, HttpServletResponse response)
throws ServletException, IOException;
}
```

<br>

## MemberFormControllerV2

### 회원 등록 폼

```java
package hello.servlet.web.frontcontroller.v2.controller;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.ControllerV2;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
public class MemberFormControllerV2 implements ControllerV2 {
 @Override
 public MyView process(HttpServletRequest request, HttpServletResponse
response) throws ServletException, IOException {
 return new MyView("/WEB-INF/views/new-form.jsp");
 }
}
```

<br>

### 회원 저장

```java
package hello.servlet.web.frontcontroller.v2.controller;
import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.ControllerV2;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
public class MemberSaveControllerV2 implements ControllerV2 {
 private MemberRepository memberRepository = MemberRepository.getInstance();
 @Override
 public MyView process(HttpServletRequest request, HttpServletResponse
response) throws ServletException, IOException {
 String username = request.getParameter("username");
 int age = Integer.parseInt(request.getParameter("age"));
 Member member = new Member(username, age);
 memberRepository.save(member);
 request.setAttribute("member", member);
 return new MyView("/WEB-INF/views/save-result.jsp");
 }
}
```

<br>

### 회원 목록

```java
package hello.servlet.web.frontcontroller.v2.controller;
import hello.servlet.domain.member.Member;
import hello.servlet.domain.member.MemberRepository;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.ControllerV2;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.List;
public class MemberListControllerV2 implements ControllerV2 {
 private MemberRepository memberRepository = MemberRepository.getInstance();
 @Override
 public MyView process(HttpServletRequest request, HttpServletResponse
response) throws ServletException, IOException {
 List<Member> members = memberRepository.findAll();
 request.setAttribute("members", members);
 return new MyView("/WEB-INF/views/members.jsp");
 }
}
```

<br>

## 프론트 컨트롤러 V2

```java
package hello.servlet.web.frontcontroller.v2;
import hello.servlet.web.frontcontroller.MyView;
import hello.servlet.web.frontcontroller.v2.controller.MemberFormControllerV2;
import hello.servlet.web.frontcontroller.v2.controller.MemberListControllerV2;
import hello.servlet.web.frontcontroller.v2.controller.MemberSaveControllerV2;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
@WebServlet(name = "frontControllerServletV2", urlPatterns = "/front-controller/
v2/*")
public class FrontControllerServletV2 extends HttpServlet {
 private Map<String, ControllerV2> controllerMap = new HashMap<>();
 public FrontControllerServletV2() {
 controllerMap.put("/front-controller/v2/members/new-form", new
MemberFormControllerV2());
 controllerMap.put("/front-controller/v2/members/save", new
MemberSaveControllerV2());
 controllerMap.put("/front-controller/v2/members", new
MemberListControllerV2());
 }
 @Override
 protected void service(HttpServletRequest request, HttpServletResponse
response)
 throws ServletException, IOException {
 String requestURI = request.getRequestURI();
 ControllerV2 controller = controllerMap.get(requestURI);
 if (controller == null) {
 response.setStatus(HttpServletResponse.SC_NOT_FOUND);
 return;
 }
 MyView view = controller.process(request, response);
 view.render(request, response);
 }
}
```

ControllerV2의 반환 타입이 `MyView` 이므로 프론트 컨트롤러는 컨트롤러의 호출 결과로 `MyView` 를 반환 받는다.

그리고 `view.render()` 를 호출하면 `forward` 로직을 수행해서 JSP가 실행된다

<br>

`MyView.render()`

```java
public void render(HttpServletRequest request, HttpServletResponse response)
throws ServletException, IOException {
 RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
 dispatcher.forward(request, response);
}
```

프론트 컨트롤러의 도입으로 MyView 객체의 `render()` 를 호출하는 부분을 모두 일관되게 처리할 수 있다.

각각의 컨트롤러는 `MyView` 객체를 생성만 해서 반환하면 된다.

<br>

> 실행

- 등록: [http://localhost:8080/front-controller/v2/members/new-form](http://localhost:8080/front-controller/v2/members/new-form)
- 목록: [http://localhost:8080/front-controller/v2/members](http://localhost:8080/front-controller/v2/members)

<br><br>

# 4. Model 추가 - v3

<br>

<br>

<br>

<br>

<br>

<br>

<br>

<br><br>

# 5. 단순하고 실용적인 컨트롤러 - v4

<br>

<br>

<br>

<br>

<br>

<br>

<br><br>

# 6. 유연한 컨트롤러1 - v5

<br>

<br>

<br>

<br>

<br>

<br>

<br><br>

# 7. 유연한 컨트롤러2 - v5

<br>

<br>

<br>

<br>

<br>

<br>

<br><br>

# 8. 정리

<br>

<br>

<br>

<br>

<br>

<br>

<br>
