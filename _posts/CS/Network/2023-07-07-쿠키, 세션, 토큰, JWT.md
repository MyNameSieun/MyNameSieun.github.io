---
title: "[Network] 쿠키, 세션, 토큰, JWT"
categories: [Network]
tag: [Network, CS]
toc_label: Contents
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "counts"
---

<br>

# 1. HTTP 프로토콜의 특성

쿠키와 세션은 HTTP 프로토콜의 특성을 보완하기 위해서 사용한다.

|          HTTP 특성          |                                      서명                                       |
| :-------------------------: | :-----------------------------------------------------------------------------: |
| Connectionless (비연결지향) |      클라이언트가 요청을 한 후 서버가 응답을 보내면 그 연결을 끊어 버린다.      |
|    stateless (무상태성)     | 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보는 유지하지 않는다. |

> HTTP의 2가지 특성인 Connectionless 과 stateless 로 인해 서버는 클라이언트의 상태를 알 수 없다는 문제가 있다.

- 예를들어 클라이언트의 상태를 서버가 알지 못한다면 페이지를 이동할 때마다 로그인을 다시 해야 할 것이다.
- 따라서 클라이언트의 상태를 알기 위해 ( ex.인증 ) 쿠키와 세션을 사용한다.

<br><br>

# 2. 쿠키(Cookie) 개요

## 2.1 쿠키 개념

> 브라우저에 저장되는 텍스트 파일을 말한다.. key-value 형태로 저장된다.

<br>

## 2.2 쿠키 특징

- 쿠키는 사용자 인증이 유효한 만료일(저장 기간) 설정할 수 있으며, 별도로 삭제처리하거나 유효기간이 만료되지 않는 이상 서버와 통신할 때 자동으로 주고 받게 된다.
- 저장된 쿠키는 클라이언트 로컬 PC(하드 드라이브에 텍스트 파일)에 저장되며, 각각의 쿠키는 이름, 값, 만료 날짜/시간, 도메인 등의 속성을 가진다.
- 서버에 특정 API 요청을 했을 때 서버가 응답 시 header 안에 set-cookie 속성으로 쿠키 정보를 담아주면

<br>

## 2.3 쿠키 동작 방식

- 클라이언트가 페이지를 요청(사용자가 웹사이트에 접근) 하면 웹 서버에서 쿠키를 생성한다.

- 클라이언트가 요청을 보낼 때, 웹 서버는 HTTP 헤더에 쿠키를 포함시켜 응답한다.

- 응답을 받은 브라우저(클라이언트)는 쿠키를 브라우저에 `자동으로` 저장한다. (저장된 쿠키정보는 `개발자도구 → 애플리케이션 → 저장용량 → 쿠키` 에서 확인 가능)

- 동일 사이트 재방문시 클라이언트의 PC에 해당 쿠키가 있는 경우, 브라우저에 저장되어 있는 쿠키는 `자동으로` 서버에 보내진다. (단, 동일한 Origin 또는 CORS를 허용하는 Origin에만 쿠키를 보낸다. ex- 유튜브 서버에서 받은 쿠키는 유튜브 이용 시에만 주고 받을 수 있다.)

- 이전 상태 정보를 변경할 필요가 있을 때 웹 서버는 HTTP 헤더에 "Set-Cookie"를 포함시켜 클라이언트에게 전송하고, 클라이언트는 이를 수신하여 변경한 쿠키를 서버로 전송한다.

<br>

## 2.4 Origin과 CORS

> Origin 이란?

출처(origin) 이란 protocol + host + port 를 의미한다.

![](/assets/images/2024/2024-02-19-16-31-37.png)

<br>

> CORS 란?

- Cross Origin Resource Sharing(CORS)는 다른 origin(출처) 에 리소스 요청하는 것을 허용하는 정책을 말한다.
- 브라우저는 보안상의 이유로 기본적으로 Same Origin Policy(SOP)를 원칙으로 하고 있지만, 서버와 클라이언트 각각 CORS 설정을 통해 상호합의된 웹사이트는 예외적으로 서로 다른 출처(Cross-Origin)임에도 API 요청이 가능하다.

<br>

## 2.5 사용 예시

> 사용자가 로그인 정보를 기억하도록 하거나, 사용자가 웹 사이트의 설정을 유지하도록 할 때 사용

- 자동 로그인
- 쇼핑몰 장바구니

<br><br>

# 3. 세션(Session) 개요

## 3.1 세션 개념

> - 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지하는 것을 말한다.
> - 즉, 사용자와 서버 간의 연결이 활성화된 상태를 의미하는 개념이다.

<br>

## 3.2 세션 특징

- 사용자에 대한 정보를 서버에 두기 때문에 보안에 좋다.
- 세션은 서버에 저장되어 서버 자원을 사용하기 때문에 사용자가 많을 경우 많은 자원을 소모한다.
- 서버 용량이 허용하는 한 저장 데이터에 제한이 없다.

<br>

## 3.3 세션 동작 방식

로그인 성공 → 서버에서 세션 생성 및 저장(key-value 형식) → 세션 key(sessionId)를 쿠키로서 브라우저에 전달(응답)

<br>

## 3.4 쿠키-세션 인증 방식

> 로그인/회원가입 시 세션 인증

- 로그인/회원가입 성공 시 서버는 DB에 정보가 있다면 sessionId를 발급받아 클라이언트(브라우저)에게 전달한다. 브라우저는 sessionId를 쿠키에 저장한다.
- 세션 유지 상태 : 로그인된 사용자의 세션 상태는 서버에서 관리하는 세션 저장소에 sessionId와 관련된 회원 데이터가 존재한다.
- 세션 만료 상태 : 세션 만료 시, 서버에서 관리하는 세션 저장소에 해당하는 sessionId와 관련된 회원 데이터가 없다.

![](/assets/images/2024/2024-02-19-16-35-13.png)

<br>

> 인가(Authorization) 필요한 API 요청/응답

서버는 인가가 필요한 API 요청을 받으면 클라이언트(브라우저) 쿠키에 들어 있는 sessionId를 세션 저장소에 조회하여 있으면 DB에 데이터를 조회하여 응답한다.

![](/assets/images/2024/2024-02-19-16-35-41.png)

<br>

## 3.5 사용 예시

> 사용자가 웹 사이트에 로그인하고 상태를 유지하는 동안 세션을 사용 가능

- 화면이 이동해도 로그인이 풀리지 않고 로그아웃하기 전까지 유지

<br><br>

# 4. 쿠키 vs 세션

> 먼저 표를 통해 쿠키와 세션의 차이점을 살펴보자 (아래 표: [쿠키(Cookie), 세션(Session) 특징 및 차이](https://hahahoho5915.tistory.com/32))

|                       |                                        쿠키                                        |                 세션                  |
| :-------------------: | :--------------------------------------------------------------------------------: | :-----------------------------------: |
|       저장 위치       |                               클라이언트(=접속자 PC)                               |                웹 서버                |
|       저장 형식       |                                        text                                        |                Object                 |
|       만료 시점       | 쿠키 저장시 설정 (브라우저가 종료되도, 만료시점이 지나지 않으면 자동삭제되지 않음) | 브라우저 종료시 삭제 (기간 지정 가능) |
| 사용하는 지원(리소스) |                                 클라이언트 리소스                                  |            웹 서버 리소스             |
|       용량 제한       |           총 300개, 하나의 도메인 당 20개, 하나의 쿠키 당 4KB(=4096byte)           |   서버가 허용하는 한 용량제한 없음    |
|         속도          |                                   세션보다 빠름                                    |             쿠키보다 느림             |
|         보안          |                                  세션보다 안좋음                                   |             쿠키보다 좋음             |

<br>

> 쿠키와 세션의 가장 큰차이점은 상태 정보의 저장 위치이다.

- 쿠키는 사용자 정보를 클라이언트(=로컬PC)에 저장하고, 세션은 서버에 저장한다.
- 때문에 쿠키는 서버의 자원을 전혀 사용하지 않으며, 세션은 서버의 자원을 사용한다.
- 보안은 세션이 더 높으며, 요청 속도는 쿠키가 빠르다. (세션은 서버 처리 필요하기 때문)

<br>

> 왜 쿠키를 주로 사용할까?

- 세션은 서버 자원을 사용하기 때문에 사용자가 많을 경우 많은 자원을 소모하여 속도가 느려질 수 있기 때문에 쿠키를 주로 사용한다.

<br><br>

# 5. 토큰 (token) 개요

## 5.1 토큰(token) 개념

> 클라이언트에서 보관하는 `암호화된 인증 정보`를 의미한다. (세션은 서버에서 보관)

- 세션처럼 서버에서 사용자의 인증 정보를 보관할 필요가 없기 때문에 서버 부담을 줄여주는 인증 수단이다.
- 웹에서 인증 수단으로 사용되는 토큰은 주로 `JWT (Json Web Token)` 을 이용한다.

## 5.2 JWT

1. `header.payload.signature` 형식으로 3가지 데이터로 구성되어 있다.
2. 국제 인터넷 표준 인증 규격 중 하나이다.
3. 암호화된 토큰을 누구나 복호화하여 payload를 볼 수 있다. → 토큰의 용도는 인증정보(payload)에 대한 보호가 아니라 `위조 방지`
4. 정보(payload)를 토큰화할 때 signature에 secret key가 필요하고, secret key는 복호화가 아니라 토큰이 유효한 지를 검증하는 데 사용된다.

![](/assets/images/2024/2024-02-19-21-32-23.png)

<br>

## 5.3 JWT 토큰 인증 방식

> 로그인/회원가입 시 토큰 인증

![](/assets/images/2024/2024-02-19-16-38-15.png)

<br>

> 인가(Authorization) 필요한 API 요청/응답

![](/assets/images/2024/2024-02-19-16-38-41.png)

- `Refresh Token` 으로 보안 강화
- 리소스 접근 인가를 받기 위해 사용되는 토큰을 Access Token 이라고 부른다.
- Access Token의 만료기간을 길게 잡고 인증상태를 오래 가져갈 경우 서버 부담은 줄어드나 보안성(탈취 당할 경우)에 허점이 있다. -인증 보안이 중요한 서비스의 경우 인증 시 2개의 토큰 (Access Token, Refresh Token)을 발급하고 Access Token의 기간은 30분 정도로 짧게 가져 가고, Refresh Token은 1~2주 정도로 길게 잡는 경우가 많다.
- 이 경우 서버에서는 Access Token이 만료되었을 때 Refresh Token 이 유효한 상태면 새로운 Access Token을 클라이언트에 발급해주고 인증상태를 유지할 수 있도록 하고, Refresh Token 만료 시 다시 로그인하라는 메시지를 응답한다.

<br>

## 5.4 세션 인증 vs. 토큰 인증

|                    | 세션 인증 | 토큰 인증  |
| :----------------: | :-------: | :--------: |
| 인증정보 저장 위치 |   서버    | 클라이언트 |
| 확장성(Scale-out)  |    Bad    |    Good    |
|  보안성 (상대적)   |   Good    |    Bad     |
|   비용 (상대적)    | Expensive |   Cheap    |

<br><br>

# 6. 참조

- https://interconnection.tistory.com/74
- https://jjongins.tistory.com/118
- https://hahahoho5915.tistory.com/32
