---
title: "[React] ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¥¸ ë Œë”ë§"
categories: [React]
tag: [React]
toc_label: Contents
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "counts"
---

<br>

# 1. ì„¸íŒ…

## 1.1 clone

- [ê¸°ì´ˆ ì†ŒìŠ¤ì½”ë“œâ†—ï¸](https://github.com/wonee09/nbcamp-timeattack-2.git)
- [ì™„ì„± ì†ŒìŠ¤ì½”ë“œ ë° ì¸ì¦ API ëª…ì„¸ì„œ(README)â†—ï¸](https://github.com/MyNameSieun/React-Project-Setting)

<br>

## 1.2 íŒŒì¼ êµ¬ì¡°

![](/assets/images/2024/2024-08-09-18-42-16.png)

<br>

## 1.3 json-server ì‹¤í–‰

```shell
yarn json-server db.json --port 3001
```

<br><br>

# 2. Router ì‘ì„±

## 2.1 Router ì—°ê²°

> ìš”êµ¬ì‚¬í•­

0. ë¼ìš°íŒ…ì€ "ì¤‘ì²© ë¼ìš°íŒ…"ìœ¼ë¡œ ì‘ì„±í•  ê²ƒ!
1. ë¡œê·¸ì¸ ì—¬ë¶€ê°€ ìƒê´€ì—†ëŠ”(ë¡œê·¸ì¸í•´ë„, í•˜ì§€ ì•Šì•„ë„ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”) í˜ì´ì§€ëŠ” `Layout.jsx`ë¥¼ ê³µí†µ elementë¡œ ì‚¬ìš©í•˜ê¸°
   1. ëŒ€ìƒ: Home, SearchPage, TestPage
2. ë¡œê·¸ì¸ ìƒíƒœê°€ ë°˜ë“œì‹œ ì•„ë‹ˆì–´ì•¼ í•˜ëŠ”(ë¡œê·¸ì¸ í•œ ìƒíƒœë©´ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ”) í˜ì´ì§€ëŠ” `NonAuthLayout.jsx`ë¥¼ ê³µí†µ elementë¡œ ì‚¬ìš©í•˜ê¸°
   1. ëŒ€ìƒ: LoginPage, SignupPage
3. ë¡œê·¸ì¸ì´ ë°˜ë“œì‹œ í•„ìš”í•œ(ë¡œê·¸ì¸ í•´ì•¼ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”) í˜ì´ì§€ëŠ” `AuthLayout.jsx`ë¥¼ ê³µí†µ elementë¡œ ì‚¬ìš©í•˜ê¸°
   1. ëŒ€ìƒ: UserProfile
4. ì–´ëŠê²ƒì—ë„ í¬í•¨ë˜ì§€ ì•ŠëŠ” í˜ì´ì§€ì˜ ê²½ìš° NotFound(src > pages > default-set > `NotFound.jsx`)ë¥¼ ë Œë”ë§í•˜ê¸°

```jsx
// src/shared/Router.jsx
import { BrowserRouter as Router, Route, Routes } from "react-router-dom";
import Layout from "../components/layouts/Layout";
import NonAuthLayout from "../components/layouts/NonAuthLayout";
import AuthLayout from "../components/layouts/AuthLayout";
import Home from "../pages/Home";
import SearchPage from "../pages/SearchPage";
import TestPage from "../pages/TestPage";
import NotFound from "../pages/default-set/NotFount";
import LoginPage from "../pages/non-auth/LoginPage";
import SignupPage from "../pages/non-auth/SignupPage";
import UserProfilePage from "../pages/auth/UserProfilePage";

export default function RouterPage() {
  return (
    <Router>
      <Routes>
        {/* ë¡œê·¸ì¸ ì—¬ë¶€ ìƒê´€ì—†ëŠ” ë¼ìš°í„° */}
        <Route element={<Layout />}>
          <Route path="/" element={<Home />} />
          <Route path="/search" element={<SearchPage />} />
          <Route path="/testPage" element={<TestPage />} />
        </Route>

        {/* ë¡œê·¸ì¸ ìƒíƒœê°€ ë°˜ë“œì‹œ ì•„ë‹ˆì–´ì•¼ í•˜ëŠ” ë¼ìš°í„° */}
        <Route element={<NonAuthLayout />}>
          <Route path="/login" element={<LoginPage />} />
          <Route path="/signup" element={<SignupPage />} />
        </Route>

        {/* ë¡œê·¸ì¸ì´ í•„ìš”í•œ ë¼ìš°í„° */}
        <Route element={<AuthLayout />}>
          <Route path="/user/:userId" element={<UserProfilePage />} />
        </Route>

        {/* 404 Not Found */}
        <Route path="*" element={<NotFound />} />
        <Route />
      </Routes>
    </Router>
  );
}
```

<br>

## 2.2 Outlet ì—°ê²°

> ê° ê³µí†µ element(Layout, AuthLayout, NonAuthLayout)ëŠ” Outletì„ ê°€ì§€ê³  ìˆì–´ì„œ ì¤‘ì²©ëœ ì»´í¬ë„ŒíŠ¸ê°€ Layoutì„ ì ìš©ë°›ì€ ìƒíƒœì—ì„œ ë Œë”ë§ ë  ìˆ˜ ìˆë„ë¡ í•˜ê¸°

### 2.2.1 Layout.jsx

```jsx
import { Outlet } from "react-router-dom";
import Navigation from "../Navigation";

const Layout = () => {
  return (
    <div>
      <h1>Common Layout</h1>
      <p>ë¡œê·¸ì¸ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
      <Navigation />
      <main>
        <Outlet />
      </main>
    </div>
  );
};

export default Layout;
```

<br>

### 2.2.2 AuthLayout.jsx

```jsx
import { Navigate, Outlet } from "react-router-dom";
import Navigation from "../Navigation";

const AuthLayout = () => {
  return (
    <div>
      <h1>Auth Layout</h1>
      <p>ë°˜ë“œì‹œ ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì–´ì•¼ í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
      <Navigation />
      <main>
        <Outlet />
      </main>
    </div>
  );
};

export default AuthLayout;
```

<br>

### 2.2.3 NonAuthLayout.jsx

```jsx
import { Navigate, Outlet } from "react-router-dom";
import Navigation from "../Navigation";

const NonAuthLayout = () => {
  return (
    <div>
      <h1>Non Auth Layout</h1>
      <p>ë¡œê·¸ì¸ì´ ë°˜ë“œì‹œ ì•ˆë˜ì–´ìˆì–´ì•¼ í•˜ëŠ” í˜ì´ì§€</p>
      <Navigation />
      <main>
        <Outlet />
      </main>
    </div>
  );
};

export default NonAuthLayout;
```

<br><br>

# 3. custom axios ì‘ì„±

## 3.1 auth.js

> ìš”êµ¬ì‚¬í•­

1. authApi ìƒì„±
   1. ê¸°ë³¸urlì„ https://moneyfulpublicpolicy.co.kr/ ë¡œ ì„¤ì •
   2. haedersëŠ” "Content-Type": "application/json" ë¡œ ì„¤ì •
2. ìš”ì²­ interceptor ì„¤ì •
   1. request interceptorì—ì„œ ìš”ì²­í•˜ëŠ” urlì´ â€œuserâ€ì¸ ê²½ìš°ëŠ” localStorageì— ìˆëŠ” accessTokenì„ headerì— í¬í•¨ì‹œí‚´
   2. ì´ ê²½ìš°, accessTokenì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì•„ë˜ ì½”ë“œë¡œ ì²˜ë¦¬í•˜ì—¬ ì‹¤íŒ¨ ë™ì‘<br><br>
   ```jsx
   alert("ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
   return Promise.reject("ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
   ```

<br><br>

configë¥¼ consoleì— ì°ìœ¼ë©´ ì‚¬ìš©ì ìš”ì²­ì— ëŒ€í•œ urlì´ ë‚˜ì˜¨ë‹¤.

```jsx
authApi.interceptors.request.use(
  (config) => {
    console.log(config);
    return config;
  },
  () => {}
);
```

![](/assets/images/2024/2024-08-09-15-31-50.png)

<br>

ì¦‰, ì´ urlì„ í™œìš©í•˜ì—¬ access token checkë¥¼ í•  ìˆ˜ ìˆë‹¤!

```jsx
import axios from "axios";

export const authApi = axios.create({
  baseURL: "https://moneyfulpublicpolicy.co.kr/",
  headers: {
    "Content-Type": "application/json",
  },
});

// ì¸í„°ì…‰í„° ì„¤ì •
authApi.interceptors.request.use(
  (config) => {
    console.log(config);

    const ac = localStorage.getItem("accessToken");

    if (config.url === "/user") {
      if (ac) {
        // Bearerì€ ì†Œìœ ìë¼ëŠ” ëœ»ì¸ë°, "ì´ í† í°ì˜ ì†Œìœ ìì—ê²Œ ê¶Œí•œì„ ë¶€ì—¬í•´ì¤˜"ë¼ëŠ” ì˜ë¯¸
        // Bearerë’¤ì— ìˆëŠ” ê²ƒì„ accessTokenìœ¼ë¡œ ì‚¬ìš©

        // ( config.headers.Authorization = )ê³¼ ë™ì¼
        config.headers["Authorization"] = `Bearer ${ac}`;
      } else {
        alert("ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return Promise.reject("ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤! ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.");
      }
    }

    // urlì— ë”°ë¥¸ ë¶„ê¸°
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);
```

<br>

## 3.2 posts.js

> ìš”êµ¬ì‚¬í•­

âš ï¸ postsAxiosëŠ” ê¶Œí•œì´ í•„ìš” ì—†ëŠ” ìš”ì²­ì´ë¼ ê°€ì •í•œë‹¤. ë”°ë¼ì„œ ìš”ì²­ interceptorë¥¼ ë³„ë„ë¡œ ì‘ì„±í•˜ì§€ ì•ŠëŠ”ë‹¤.

1. ê¸°ë³¸ urlì„ json-server ì£¼ì†Œ(localhost:3001ë²ˆ ê¶Œì¥)/postsë¡œ ì„¤ì • (ex : http://localhost:3001/posts)
2. timeoutì„ 1.5ì´ˆë¡œ ì„¸íŒ…

```jsx
import axios from "axios";

const postsAxios = axios.create({
  baseURL: "http://localhost:3001/posts",
  timeout: 1500,
});

export default postsAxios;
```

<br>

## 3.3 comments.js

> ìš”êµ¬ì‚¬í•­

1. commentsAxios ìƒì„±
   1. commentsAxiosëŠ” ê¶Œí•œì´ ë°˜ë“œì‹œ í•„ìš”í•œ ìš”ì²­ì´ë¼ ê°€ì •í•œë‹¤. ë”°ë¼ì„œ ìš”ì²­ interceptorë¥¼ ì‘ì„±í•˜ì—¬ ì‚¬ì „ì— userì˜ ê¶Œí•œì„ íŒŒì•…í•œë‹¤.
   2. ê¸°ë³¸ urlì„ json-server ì£¼ì†Œ(localhost:3001ë²ˆ ê¶Œì¥)/comments ì„¤ì • (ex : http://localhost:3001/comments)
   3. timeoutì„ 1.5ì´ˆë¡œ ì„¸íŒ…
2. ìš”ì²­ interceptor ì„¤ì •
   1. customìœ¼ë¡œ ë§Œë“  authApiì— user ìš”ì²­(í•˜ë‹¨ ì¸ì¦ API ëª…ì„¸ì„œ - íšŒì›ì •ë³´ í™•ì¸ ì°¸ê³ )ì„ í†µí•´ ê²€ì¦ì„ ì§„í–‰ - ë°˜ë“œì‹œ authApië¥¼ ì´ìš©
3. ì‘ë‹µ interceptor ì„¤ì •
   1. ìš”ì²­ì´ ì„±ê³µ ì‘ë‹µì„ ë°›ì€ ê²½ìš°, `console.log("ìš”ì²­ ì„±ê³µì…ë‹ˆë‹¤.")`ë¥¼ ì¶œë ¥

<br>

- ë²„íŠ¼ì´ ëˆŒë¦¬ëŠ” ì‹œì ì— ê¶Œí•œì´ ìˆëŠ”ì§€ íŒŒì•…í•´ì•¼í•œë‹¤.
- ì´ë¥¼ ìœ„í•´ onClickì„ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ commnets ìš”ì²­ì— request ë¶€ë¶„ì—ì„œ ë¡œì§ì„ ì‘ì„±í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```jsx
import axios from "axios";
import { authApi } from "./auth";

const commentsAxios = axios.create({
  baseURL: `${process.env.REACT_APP_API_URL}/comments/`,
  timeout: 1500,
});

commentsAxios.interceptors.request.use(
  async (config) => {
    // ìœ ì €ê°€ ê°€ì§€ê³  ìˆëŠ” accessTokenì´ ì§€ê¸ˆ ìš”ì²­ì„ ë³´ë‚´ë ¤ê³  í•˜ëŠ” ì´ ì‹œì ì— ë§ì•„?? ì •í™•í•´?? ìœ íš¨ê¸°ê°„ ìˆì–´?? ë¥¼ íŒŒì•…í•´ì•¼í•œë‹¤!
    const ac = localStorage.getItem("accessToken");

    try {
      // (1) ìœ ì € ê¶Œí•œ ì²´í¬ to ë°±ì—”ë“œ
      await axios.get("/user", {
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer &{ac}`,
        },
      });
      return config; // ì„±ê³µ
    } catch (error) {
      return Promise.reject(error);
    }
  },
  (error) => {
    return error;
  }
);

commentsAxios.interceptors.response.use((response) => {
  console.log("ìš”ì²­ ì„±ê³µì…ë‹ˆë‹¤.");
  return response;
});

export default commentsAxios;
```

<br>

> ë¦¬íŒ©í† ë§

- auth.js ì™€ ì½”ë“œì™€ ì¤‘ë³µë˜ë‹ˆ auth.jsì— ì¡´ì¬í•˜ëŠ” userë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•˜ì
- ì´ë ‡ê²Œ ë˜ë©´ accessTokenê³¼ headers ì„¸íŒ…ì´ í•„ìš” ì—†ì–´ì§„ë‹¤!
- ì•„ë˜ ì²˜ëŸ¼ comments.jsì—ì„œ userì„ ë„˜ê¸°ë©´ auth.jsê°€ ë¶„ê¸°ë¥¼ í•´ì¤€ë‹¤.

```jsx
import axios from "axios";
import { authApi } from "./auth";

const commentsAxios = axios.create({
  baseURL: `${process.env.REACT_APP_API_URL}/comments/`,
  timeout: 1500,
});

commentsAxios.interceptors.request.use(
  async (config) => {
    try {
      // (1) ìœ ì € ê¶Œí•œ ì²´í¬ to ë°±ì—”ë“œ
      await authApi.get("/user");
      return config; // ì„±ê³µ
    } catch (error) {
      return Promise.reject(error);
    }
  },
  (error) => {
    return error;
  }
);

commentsAxios.interceptors.response.use((response) => {
  console.log("ìš”ì²­ ì„±ê³µì…ë‹ˆë‹¤.");
  return response;
});

export default commentsAxios;
```

<br>

ì™¼ìª½ comment.jsê°€ í†µê³¼í–ˆë‹¤ëŠ” ì´ì•¼ê¸°ëŠ” ì´ë¯¸ auth.jsê°€ í†µê³¼í–ˆë‹¤ëŠ” ì´ì•¼ê¸°ì„!

![](/assets/images/2024/2024-08-09-16-04-17.png)

<br><br>

# 4. íšŒì›ê°€ì…, ë¡œê·¸ì¸ ê¸°ëŠ¥

## 4.1 íšŒì›ê°€ì…(SignupPage.jsx)

> ìš”êµ¬ì‚¬í•­

1. íšŒì›ê°€ì… ì„±ê³µ ì‹œ
   1. alertë¡œ "íšŒì›ê°€ì…ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê²Œìš”" ë©”ì‹œì§€ ì¶œë ¥
   2. login í˜ì´ì§€ë¡œ ìë™ ì´ë™
2. íšŒì›ê°€ì… ì‹¤íŒ¨ ì‹œ
   1. alertë¡œ ë°±ì—”ë“œì—ì„œ ì œê³µë°›ì€ ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥
   2. console.logë¡œ ì˜¤ë¥˜ ë‚´ìš© ì „ì²´ ì¶œë ¥

```jsx
// src/pages/non-auth/SignupPage.jsx
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { authApi } from "../../axios/auth";

const SignupPage = () => {
  const navigate = useNavigate();

  const [id, setId] = useState("");
  const [password, setPassword] = useState("");
  const [nickname, setNickname] = useState("");

  return (
    <div>
      <h1>Signup</h1>
      <p>Signup page</p>

      <form
        onSubmit={async (e) => {
          e.preventDefault();

          try {
            await authApi.post("/register", {
              id,
              password,
              nickname,
            });
            // ì„±ê³µ ì‹œ
            alert("ì¶”ì¹´ í¬ì¹´ğŸ‡ ë¡œê·¸ì¸ ì™„ë£Œ");
            navigate("/login");
          } catch (error) {
            // ì‹¤íŒ¨ ì‹œ
            const message = error.response.data.message;
            alert(message); // ì‚¬ìš©ì í™•ì¸
            console.log(message); // ê°œë°œì í™•ì¸
          }
        }}
      >
        <div>
          <label htmlFor="id">id</label>
          <input
            type="string"
            id="id"
            value={id}
            onChange={(e) => setId(e.target.value)}
          />
        </div>
        <div>
          <label htmlFor="nickname">nickname</label>
          <input
            type="string"
            id="nickname"
            value={nickname}
            onChange={(e) => setNickname(e.target.value)}
          />
        </div>

        <div>
          <label htmlFor="password">Password</label>
          <input
            type="password"
            id="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
          />
        </div>

        <button type="submit">Signup</button>
        <button
          type="button"
          onClick={() => {
            navigate("/login");
          }}
        >
          ë¡œê·¸ì¸í•˜ëŸ¬ê°€ê¸°
        </button>

        <button
          type="button"
          onClick={() => {
            navigate("/");
          }}
        >
          í™ˆìœ¼ë¡œ
        </button>
      </form>
    </div>
  );
};

export default SignupPage;
```

<br>

## 4.2 ë¡œê·¸ì¸ ê¸°ëŠ¥(LoginPage.jsx)

> ìš”êµ¬ì‚¬í•­

1. ë¡œê·¸ì¸ ì„±ê³µ ì‹œ
   1. alertë¡œ "ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê²Œìš”" ë©”ì‹œì§€ ì¶œë ¥
   2. localStorageì— ì €ì¥(accessToken, userId, nickname)
   3. ë©”ì¸ í˜ì´ì§€(Home ì»´í¬ë„ŒíŠ¸, ê²½ë¡œìƒ â€œ/â€)ë¡œ ìë™ ì´ë™
2. ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ
   1. alertë¡œ ë°±ì—”ë“œì—ì„œ ì œê³µë°›ì€ ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥
   2. console.logë¡œ ì˜¤ë¥˜ ë‚´ìš© ì „ì²´ ì¶œë ¥

```jsx
// src/pages/non-auth/LoginPage.jsx
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { authApi } from "../../axios/auth";

const LoginPage = () => {
  const navigate = useNavigate();

  const [id, setId] = useState("");
  const [password, setPassword] = useState("");

  return (
    <div>
      <h1>Login</h1>
      <p>Login page</p>

      <form
        onSubmit={async (e) => {
          e.preventDefault();

          try {
            // (1) ë¡œê·¸ì¸ ì‹œë„
            const response = await authApi.post("login", {
              id,
              password,
            });

            // (2) localStorageì— í† í° ì €ì¥(ì‚¬ì‹¤ í•„ìš”ì—†ìŒ(ê·¸ëƒ¥ ì•ˆì „í•˜ê²Œ ë„£ì–´ë†“ì€ ê²ƒ) -> response.dataì— accessTokenì´ ë¬´ì¡°ê±´ ìˆê¸° ë•Œë¬¸)
            if (!response.data.accessToken) {
              alert("í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.");
              return;
            }

            // (3) ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ì•ˆë‚´ ë©”ì‹œì§€
            alert("ë¡œê·¸ì¸ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤. ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê²Œìš”.");

            localStorage.setItem("accessToken", response.data.accessToken);
            localStorage.setItem("userId", response.data.userId);
            localStorage.setItem("nickname", response.data.nickname);

            // (4) ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            navigate("/");
          } catch (error) {
            alert(error.response.data.message);
          }
        }}
      >
        <div>
          <label htmlFor="id">id</label>
          <input
            type="text"
            id="id"
            value={id}
            onChange={(e) => setId(e.target.value)}
          />
        </div>

        <div>
          <label htmlFor="password">Password</label>
          <input
            type="password"
            id="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
          />
        </div>

        <button type="submit">Login</button>
        <button
          type="button"
          onClick={() => {
            navigate("/signup");
          }}
        >
          íšŒì›ê°€ì…í•˜ëŸ¬ê°€ê¸°
        </button>
        <button
          type="button"
          onClick={() => {
            navigate("/");
          }}
        >
          í™ˆìœ¼ë¡œ
        </button>
      </form>
    </div>
  );
};

export default LoginPage;
```

<br><br>

# 5. Layout ì‘ì„±

## 5.1 AuthLayout.jsx

> ìš”êµ¬ì‚¬í•­

- ë¡œê·¸ì¸ ì‹œ localStorageì— ì €ì¥í–ˆë˜ accessTokenì„ ê¸°ì¤€ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì§€ ì•Šì€ ê²½ìš° alertë¡œ ì•ˆë‚´í•œ í›„, ë°”ë¡œ login í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚¤ê¸°
- ğŸ’¡ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ëŠ” useEffectì—ì„œ ê°€ì ¸ì˜¤ì§€ ì•Šì•„ë„ ëœë‹¤! êµ³ì´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë˜ëŠ” ì‹œì ì— ë™ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì´ë‹¤.

```jsx
import { Navigate, Outlet } from "react-router-dom";
import Navigation from "../Navigation";

const AuthLayout = () => {
  const isAuthenticated = localStorage.getItem("accessToken");

  if (!isAuthenticated) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•´ìš”. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê²Œìš”!");
    // replaceë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°€ëŠ” ê²ƒì„ ë°©ì§€(ìƒˆë¡œìš´ íˆìŠ¤í† ë¦¬ë¡œ ë®ì–´ì”Œìš°ê¸°)
    return <Navigate to="/login" replace />;
  }
  return (
    <div>
      <h1>Auth Layout</h1>
      <p>ë°˜ë“œì‹œ ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì–´ì•¼ í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
      <Navigation />
      <main>
        <Outlet />
      </main>
    </div>
  );
};

export default AuthLayout;
```

<br>

> â“useEffectë¥¼ ì‚¬ìš©í•´ì•¼ í• ê¹Œ?

- useEffectë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ íŒë‹¨í•  ê²½ìš°, ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê¸° ì „ì— ì‚¬ìš©ìê°€ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
- ì´ëŠ”, useEffectëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ëœ ì´í›„ì— ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì—, ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê¸° ì „ì— ì»´í¬ë„ŒíŠ¸ì˜ ì´ˆê¸° ë Œë”ë§ì´ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì´ë‹¤.
- ë”°ë¼ì„œ ë Œë”ë§ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” stateë¥¼ ìƒì„±í•´ì•¼ í•˜ê±°ë‚˜, useEffectë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì´ˆê¸° ë Œë”ë§ ë‹¨ê³„ì—ì„œ ì§ì ‘ì ìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ë©´ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í”¼í•  ìˆ˜ ìˆë‹¤.

<br>

## 5.2 NonAuthLayout

> ìš”êµ¬ì‚¬í•­

- ë¡œê·¸ì¸ ì‹œ localStorageì— ì €ì¥í–ˆë˜ accessTokenì´ ì¡´ì¬í•˜ë©´, í•´ë‹¹ Layoutì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒì„ ì˜ë¯¸í•˜ê¸° ë•Œë¬¸ì— alertë¡œ "ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœì…ë‹ˆë‹¤" ì•ˆë‚´í•œ í›„, ë°”ë¡œ Home í˜ì´ì§€(ì»´í¬ë„ŒíŠ¸ : Home, ê²½ë¡œ : "/")ë¡œ ì´ë™

```jsx
import { Navigate, Outlet } from "react-router-dom";
import Navigation from "../Navigation";

const NonAuthLayout = () => {
  const isAuthenticated = localStorage.getItem("accessToken") ? true : false;

  if (isAuthenticated) {
    alert("ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœì…ë‹ˆë‹¤");
    return <Navigate to="/" replace />;
  }

  return (
    <div>
      <h1>Non Auth Layout</h1>
      <p>ë¡œê·¸ì¸ì´ ë°˜ë“œì‹œ ì•ˆë˜ì–´ìˆì–´ì•¼ í•˜ëŠ” í˜ì´ì§€</p>
      <Navigation />
      <main>
        <Outlet />
      </main>
    </div>
  );
};

export default NonAuthLayout;
```

<br><br>

# 6. Navigation

> ìš”êµ¬ì‚¬í•­

- localStorageì˜ accessToken ì—¬ë¶€ì— ë”°ë¼ [ë¡œê·¸ì¸í•˜ëŸ¬ê°€ê¸°], [ë¡œê·¸ì•„ì›ƒ] ë²„íŠ¼ì„ ë‹¤ë¥´ê²Œ ë³´ì—¬ì£¼ê¸°(ì¡°ê±´ë¶€ ë Œë”ë§)

1. ë¡œê·¸ì¸í•˜ëŸ¬ê°€ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ
   1. login í˜ì´ì§€ë¡œ ë¼ìš°íŒ…
2. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì‹œ
   1. localStorageì— ì €ì¥ë˜ì–´ìˆëŠ” accessToken, userId, nicknameì„ ì œê±°
   2. Home í˜ì´ì§€(ì»´í¬ë„ŒíŠ¸ : Home, ê²½ë¡œ : "/")ë¡œ ì´ë™
3. `ul`íƒœê·¸ ë‚´ë¶€ì˜ `li` íƒœê·¸ë¥¼ í™œìš©í•˜ì—¬ ê° í˜ì´ì§€ì— ëŒ€í•œ ë‚´ë¹„ê²Œì´ì…˜ì„ ì™„ì„±ì‹œí‚¤ê¸°
   1. 1ë²ˆ ìœ ì €ì˜ ì •ë³´ : userIdë¥¼ 1ë¡œ params ì§€ì •í•  ìˆ˜ ìˆê²Œ ê²½ë¡œ ì„¤ì •
   2. 2ë²ˆ ìœ ì €ì˜ ì •ë³´ : userIdë¥¼ 2ë¡œ params ì§€ì •í•  ìˆ˜ ìˆê²Œ ê²½ë¡œ ì„¤ì •

```jsx
import { Link, useNavigate } from "react-router-dom";

const Navigation = () => {
  const navigate = useNavigate();
  const at = localStorage.getItem("accessToken") ? true : false;

  const handleLoginButton = () => {
    navigate("/login");
  };
  const handleLogoutButton = () => {
    const confirm = window.confirm("ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    if (confirm) {
      localStorage.removeItem("accessToken");
      localStorage.removeItem("userId");
      localStorage.removeItem("nickname");
      navigate("/login");
    } else {
      return;
    }
  };

  return (
    <nav>
      {/* ë¡œê·¸ì¸ ë˜ëŠ” ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */}
      {at ? (
        <button onClick={handleLogoutButton}>ë¡œê·¸ì•„ì›ƒ</button>
      ) : (
        <button onClick={handleLoginButton}>ë¡œê·¸ì¸í•˜ëŸ¬ê°€ê¸°</button>
      )}

      <ul>
        <hr />

        {/* ë¡œê·¸ì¸ ì—¬ë¶€ê°€ ìƒê´€ì—†ëŠ” ë©”ë‰´ */}
        <p>â—ï¸ ë¡œê·¸ì¸ ì—¬ë¶€ê°€ ìƒê´€ì—†ëŠ” ë©”ë‰´</p>
        <li>
          <Link to="/">í™ˆ ë©”ë‰´ë¡œ</Link>
        </li>
        <li>
          <Link to="/search">ê²€ìƒ‰í˜ì´ì§€ë¡œ</Link>
        </li>
        <li>
          <Link to="/testPage">ê¶Œí•œí…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¡œ</Link>
        </li>

        <hr />

        {/* ë¡œê·¸ì¸ì´ ë°˜ë“œì‹œ í•„ìš”í•œ ë©”ë‰´ */}
        <p>â—ï¸ ë¡œê·¸ì¸ì´ ë°˜ë“œì‹œ í•„ìš”í•œ ë©”ë‰´</p>
        <li>
          <Link to="/user/1">1ë²ˆ ìœ ì €ì˜ ì •ë³´</Link>
        </li>
        <li>
          <Link to="/user/2">2ë²ˆ ìœ ì €ì˜ ì •ë³´</Link>
        </li>
      </ul>
    </nav>
  );
};

export default Navigation;
```

<br><br>

# 7. ìƒì„¸í˜ì´ì§€ ì‘ì„±

## 7.1 Home.jsx

> ìš”êµ¬ì‚¬í•­

- access í† í°ì´
  - ì¡´ì¬í•˜ëŠ” ê²½ìš° "ì•ˆë…•í•˜ì„¸ìš” {ë‹‰ë„¤ì„}ë‹˜!"
  - ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° "ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”."

```jsx
const Home = () => {
  const at = localStorage.getItem("accessToken");
  const nickname = localStorage.getItem("nickname");
  return (
    <div>
      <h1>Home</h1>
      <p>Home page</p>

      {/* ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ì¡°ê±´ë¶€ ë Œë”ë§ */}
      {at ? <p>ì•ˆë…•í•˜ì„¸ìš”, {nickname}ë‹˜!</p> : <p>ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”.</p>}
    </div>
  );
};

export default Home;
```

## 7.2 SearchPage.jsx

> ìš”êµ¬ì‚¬í•­

1. useEffectë¥¼ í™œìš©í•˜ì—¬ ìµœì´ˆ ë Œë”ë§ ì‹œ postsAxiosë¥¼ í™œìš©í•˜ì—¬ ì „ì²´ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ stateì— ì„¸íŒ…
2. useSearchParamsë¥¼ í™œìš©í•˜ì—¬, searchParamsì— ë”°ë¥¸ postsë¥¼ filtering í•´ì„œ ë³´ì—¬ì£¼ê¸°
   1. ex ) http://localhost:3000/search?userId=2 ì¸ ê²½ìš° â‡’ ì „ì²´ postë¦¬ìŠ¤íŠ¸ ì¤‘, writerUserIdê°€ 2ì¸ ê²½ìš°ë§Œ filtering í•´ì„œ ì¶œë ¥
3. searchParamsëŠ” ì•„ë˜ ë‘ ë²„íŠ¼ì„ í†µí•´ ë³€ê²½í•˜ë„ë¡ updateSearch() í•¨ìˆ˜ë¥¼ ì™„ì„±í•˜ê¸°<br><br>
   ```jsx
   <button onClick={() => updateSearch("1")}>1ë²ˆìœ ì €ì˜ ê¸€ ë³´ê¸°</button>
   <button onClick={() => updateSearch("2")}>2ë²ˆìœ ì €ì˜ ê¸€ ë³´ê¸°</button>
   ```

<br>

```jsx
// SearchPage.jsx
import { useEffect, useState } from "react";
import { useSearchParams } from "react-router-dom";
import postsAxios from "../axios/posts";

function SearchPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  const [posts, setPosts] = useState([]);

  const userId = searchParams.get("userId");

  // URLì˜ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì„ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜
  const updateSearch = (userId) => {
    setSearchParams({ userId });
  };

  useEffect(() => {
    const getPosts = async () => {
      try {
        const response = await postsAxios.get("/");
        setPosts(response.data);
      } catch (error) {
        alert("ì˜¤ë¥˜ ë°œìƒ!");
        console.error("Failed to fetch posts:", error);
      }
    };
    getPosts();
  }, []);

  const filteredPosts = posts.filter(
    (post) => post.writeUserId === Number(userId)
  );

  return (
    <div>
      <h1>Posting ì •ë³´ ë³´ê¸°</h1>
      <div>
        {userId ? (
          <p>ì•„ì´ë”” {userId}ë‹˜ì´ ì“°ì‹  ê¸€</p>
        ) : (
          <p>ì•„ë˜ ë‘ ë²„íŠ¼ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
        )}
      </div>

      <button onClick={() => updateSearch("1")}>1ë²ˆìœ ì €ì˜ ê¸€ ë³´ê¸°</button>
      <button onClick={() => updateSearch("2")}>2ë²ˆìœ ì €ì˜ ê¸€ ë³´ê¸°</button>

      {filteredPosts?.map((post) => (
        <div key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.author}</p>
          <p>{post.body}</p>
        </div>
      ))}
    </div>
  );
}

export default SearchPage;
```

<br>

## 7.3 TestPage.jsx

> ìš”êµ¬ì‚¬í•­

âš ï¸ ì„¸íŒ…í•œ custom axiosë¡œ ì¸í•´, commentsAxiosë¥¼ í™œìš©í•˜ì—¬ ê°’ì„ ê°€ì ¸ì˜¬ ë•ŒëŠ” localStorageì— accessTokenì´ ì—†ëŠ” ê²½ìš° ì‹¤íŒ¨í•´ì•¼í•œë‹¤. ë³„ë„ ì½”ë”©ì€ í•„ìš” ì—†ìœ¼ë©°, commentsAxios ë‚´ë¶€ì— í•´ë‹¹ ë¡œì§ì´ ìˆìœ¼ë¯€ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ê¼­ í•´ë³´ë„ë¡ í•˜ì.

1. handleGetPostButtonClick : postsAxiosë¥¼ ì´ìš©í•˜ì—¬ ì „ì²´ í¬ìŠ¤íŒ…ì„ ê°€ì ¸ì˜¨ í›„, postì •ë³´ì˜ titleê³¼ authorë¥¼ ì¶œë ¥ì‹œí‚¤ë„ë¡ í•˜ì. í•´ë‹¹ ë²„íŠ¼ì´ í´ë¦­ëì„ ë•ŒëŠ” ì´ë¯¸ ì¶œë ¥ëœ comments ë¦¬ìŠ¤íŠ¸ê°€ ìˆë‹¤ë©´ ì—†ì• ì•¼ í•œë‹¤.
2. handleGetCommentsButtonClick : commentsAxiosë¥¼ í™œìš©í•˜ì—¬ ì „ì²´ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¨ í›„, comment ì •ë³´ì˜ bodyë¥¼ ì¶œë ¥ì‹œí‚¤ë„ë¡ í•˜ì. í•´ë‹¹ ë²„íŠ¼ì´ í´ë¦­ëì„ ë•ŒëŠ” ì´ë¯¸ ì¶œë ¥ëœ posts ë¦¬ìŠ¤íŠ¸ê°€ ìˆë‹¤ë©´ ì—†ì• ì•¼ í•œë‹¤.

<br>

```jsx
import React from "react";
import commentsAxios from "../axios/comments";
import postsAxios from "../axios/posts";

const TestPage = () => {
  const [posts, setPosts] = React.useState([]);
  const [comments, setComments] = React.useState([]);

  const handleGetPostButtonClick = async () => {
    try {
      const response = await postsAxios.get("/");
      setPosts(response.data);
      setComments([]);
    } catch (error) {
      console.log(error);
      alert("í¬ìŠ¤íŒ…ì„ ê°€ì ¸ì˜¤ëŠ” ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.");
    }
  };

  const handleGetCommentsButtonClick = async () => {
    try {
      const response = await commentsAxios.get("/");
      setComments(response.data);
      setPosts([]);
    } catch (error) {
      console.log(error);
      alert("accessToken ìœ íš¨ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
  };

  return (
    <div>
      <h1>Test Page</h1>
      <p>api í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</p>
      <button onClick={handleGetPostButtonClick}>
        postsê°€ì ¸ì˜¤ê¸° í…ŒìŠ¤íŠ¸(ë¡œê·¸ì¸í•„ìš”ì—†ìŒ)
      </button>
      <button onClick={handleGetCommentsButtonClick}>
        commentsê°€ì ¸ì˜¤ê¸° í…ŒìŠ¤íŠ¸(ë¡œê·¸ì¸í•„ìš”)
      </button>

      {posts?.map((post) => (
        <div key={post.id}>
          <h2>{post.title}</h2>
          <p>{post.author}</p>
        </div>
      ))}

      {comments?.map((comment) => (
        <div key={comment.id}>
          <p>{comment.body}</p>
        </div>
      ))}
    </div>
  );
};

export default TestPage;
```

<br>
