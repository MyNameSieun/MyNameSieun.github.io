---
title: "[React] 사용자 권한에 따른 렌더링"
categories: [React]
tag: [React]
toc_label: Contents
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "counts"
---

<br>

> login, logout, 권한을 연습해보자

추후 로그인 기능을 구현할 때, 토큰 검증이 실패했으면 로컬스토리지 (또는 리덕스) 에 있는 토큰을 삭제하고 로그인 페이지로 이동하면 된다.

<br>

따라서 Router 종류를 두 종류로 나누는 것이 좋다.

이렇게 구성하면 인증(로그인 상태 등)에 따라서 조건부 렌더링이 가능하다.

```js
// shared/Router.jsx
const Router = () => {
  return (
    <BrowserRouter>
      <Routes>
        {/* (1) 로그인 하지 않아도 접근할 수 있는 페이지 : 로그인 페이지, 회원가입 페이지, 상품 페이지 등 */}
        <Route element={NonAuthLayout}>
          <Route path="/login" element={<Login />} />
          <Route path="/join" element={<Join />} />
        </Route>

        {/* (2) 로그인 해야만 접근할 수 있는 페이지 : 마이페이지, 즐겨찾기 페이지 등 */}
        <Route element={AuthLayout}>
          <Route path="/mypage" element={<MyPage />} />
          <Route path="/mysth" element={<MySth />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
};
```

```js
// shared/NonAuthLayout
import React, { useEffect } from "react";
import { Outlet, useNavigate } from "react-router-dom";

const NonAuthLayout = () => {
  // 만약에 로그인이 되어있는 경우(토큰이 존재하는 경우) => 메인 페이지로 이동
  useEffect(() => {
    const navigate = useNavigate();
    // 로컬 스토리지에서 토큰 검증
    const token = localStorage.getItem("accessToken");
    if (token) {
      navigate.push("/");
    }
  }, []);

  // 로그인이 안되어있는 경우 (토큰이 존재하지 않는 경우) => 컴포넌트 렌더링
  return (
    <div>
      {/* Outlet : React Router Dom에서 제시하는 컴포넌트 */}
      <Outlet />
    </div>
  );
};

export default NonAuthLayout;
```

```js
// shared/AuthLayout
import { useEffect } from "react";
import { Outlet, useNavigate } from "react-router-dom";

const AuthLayout = () => {
  useEffect(() => {
    const navigate = useNavigate();
    // 로컬 스토리지에서 토큰 검증
    const token = localStorage.getItem("accessToken");
    if (!token) {
      navigate.push("/login");
    }
  }, []);
  return (
    <div>
      <Outlet />
    </div>
  );
};

export default AuthLayout;
```

다만, 렌더링이 먼저 완료 된 후 useEffect가 실행된다.

따라서 로그인 여부를 판단하기 전에 사용자가 화면을 볼 수 있다는 문제가 발생하기 때문에 state를 사용해야한다.

```js
// shared/AuthLayout
import { useEffect, useState } from "react";
import { Outlet, useNavigate } from "react-router-dom";

const AuthLayout = () => {
  // state 생성
  const [isRendered, setIsRendered] = useState(false);

  const navigate = useNavigate();
  useEffect(() => {
    const token = localStorage.getItem("accessToken");

    // 토큰이 없는 경우 강제 routing
    if (!token) {
      navigate.push("/login");
    }

    // 컴포넌트 렌더링
    setIsRendered(true);
  }, []);

  if (!isRendered) {
    return;
  }
  return (
    <div>
      <Outlet />
    </div>
  );
};

export default AuthLayout;
```

이렇게 하면 로그인 여부 확인 후 컴포넌트 렌더링이 가능하다.

<br>

또한 axios에서 처리해야할 로직은 다음과 같다.

- request : aixos 인터셉터에서 토큰이 존재하지 않을 경우 요청을 하지 않음 -> 바로 로그인 페이지로 이동
- response : 서버로부터 토큰이 유효하지 않다는 응답을 받았으면 로그인 상태인 토큰 값 삭제하기 -> 추후 로그인 페이지 이동

<br>

따라서 인증/인가는 axios call 할 때, routing 조건부 렌더링을 해야 완전한 코드가 될 수 있다.
