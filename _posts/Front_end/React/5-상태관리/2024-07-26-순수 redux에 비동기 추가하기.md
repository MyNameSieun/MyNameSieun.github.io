---
title: "[React] ìˆœìˆ˜ reduxì— ë¹„ë™ê¸° ì¶”ê°€í•˜ê¸°"
categories: [React]
toc_label: Contents
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "counts"
---

<br>

# 1. ì„¤ì • ë° ì„¸íŒ…

## 1.1 í™˜ê²½ ì„¤ì •

> axios í™˜ê²½ ì„¤ì¹˜ / json-server í™˜ê²½ ì„¤ì¹˜

```
yarn add axios json-server
```

<br>

## 1.2 db.json íŒŒì¼ ìƒì„±

```json
{
  "todos": [
    {
      "id": "1",
      "title": "ì˜¤ëŠ˜ ë­í•˜ì§€?",
      "contents": "ë¦¬ì•¡íŠ¸ ê³µë¶€í•˜ì!",
      "isDone": true
    },
    {
      "id": "2",
      "title": "ì €ë… ë­ ë¨¹ì§€",
      "contents": "ê°ìíƒ• ë¨¹ê³ ì‹¶ë‹¹",
      "isDone": true
    }
  ]
}
```

<br>

## 1.3 json-server ì‹¤í–‰

```
npx json-server db.json --port [ì›í•˜ëŠ” í¬íŠ¸]
```

<br><br>

# 2. í”„ë¡œì„¸ìŠ¤: dataë¥¼ reduxë¡œ ê´€ë¦¬í•˜ê¸°â­

> â‘  useEffectë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ useEffectë¥¼ ì‚¬ìš©í•´ ë¹„ë™ê¸°ë¡œ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ (axios), dispatchë¡œ Redux ìƒíƒœë¥¼ ì´ˆê¸°í™”í•œë‹¤.

```jsx
useEffect(() => {
  const getTodos = async () => {
    try {
      const { data } = await axios.get("http://localhost:4000/todos");
      dispatch(initialization(data));
    } catch (error) {
      console.error(error);
    }
  };
  getTodos();
}, []);
```

> â‘¡ dispatch ì‚¬ìš©í•˜ê¸°

ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ initialization ì•¡ì…˜ì„ dispatchí•´ Redux ìŠ¤í† ì–´ë¥¼ ì´ˆê¸°í™”í•œë‹¤.

```jsx
dispatch(initialization(data));
```

> â‘¢ useSelectorë¡œ ìƒíƒœ ì½ê¸°

`useSelector`ë¥¼ ì‚¬ìš©í•´ Redux ìŠ¤í† ì–´ì˜ todos ìƒíƒœë¥¼ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì½ì–´ì˜¨ë‹¤.

```jsx
const todos = useSelector((state) => state.todos);
```

> â‘£ ì¶”ê°€ Click

- ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ì—ì„œ axiosë¡œ ì„œë²„ì— POST ìš”ì²­ì„ ë³´ë‚´ê³ , `dispatch`ë¡œ `addTodo` ì•¡ì…˜ì„ í˜¸ì¶œí•´ Redux ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.
  - dispatch(í´ë¼ì´ì–¸íŠ¸ ì—…ë°ì´íŠ¸)ë¥¼ ì•ˆí•˜ê³  addDoc(db ì—…ë°ì´íŠ¸)ë§Œ í–ˆì„ ë•Œ, ì¶”ê°€ëœ í•­ëª©ì´ ì•ˆë³´ì„
  - addDocì„ ì•ˆí•˜ê³  dispatchë§Œ í–ˆì„ ë•Œ, DBì— ì €ì¥ì´ ì•ˆë¨ -> ìƒˆë¡œê³ ì¹¨ì‹œ ë¬¸ì œ

â­ addDocê³¼ dispatchë¥¼ ì¼ì¹˜ ì‹œí‚¤ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤!(ìŠ¤í”„ë ˆë“œ ì—°ì‚°ì ì‚¬ìš©í•˜ê¸°)<br>
ğŸ’¡ addDocê³¼ dispatchë¥¼ í•œêº¼ë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ê²Œ "RTK"ì´ë‹¤.

```jsx
const newTodo = { title, contents, isDone: false };

try {
  const response = await axios.post("http://localhost:4000/todos", newTodo);
  const newId = response.data.id;
  dispatch(addTodo({ ...newTodo, id: newId }));
  setTitle("");
  setContents("");
} catch (error) {
  alert("ì„œë²„ í†µì‹  ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
  console.error(error);
}
```

- ì‚­ì œì™€ ìˆ˜ì •ë„ ë§ˆì°¬ê°€ì§€ë¡œ `remove Doc` or `Update Doc`ì™€ `dispatch`ë¥¼ ê°™ì´ í•´ì¤˜ì•¼ í•œë‹¤!
- â­ idë¥¼ dbì— ìˆëŠ” ê°’ìœ¼ë¡œ ì¬êµ¬ì„± ì‹œí‚¤ëŠ” ì‘ì—…ì„ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.
  - (ê¸°ì¡´ì— ìˆë˜ ê°ì²´ë¥¼ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¡œ í¼ì¹œë‹¤ìŒì— id ë¶€ì—¬í•  ê²ƒ!)

<br><br>

# 3. êµ¬í˜„í•˜ê¸°

## 3.1 module ë³€ê²½

```jsx
import { v4 as uuidv4 } from "uuid";

// action items
const ADD_TODO = "ADD_TODO";
const REMOVE_TODO = "REMOVE_TODO";
const SWITCH_TODO = "SWITCH_TODO";
const INITIALIZATION = "initialization"; // ê¸°ì¡´ì˜ todos stateë¥¼ ëª¨ë‘ ì§€ì›Œë²„ë¦¬ê³ , ì™¸ë¶€ DBë¡œë¶€í„° ê°€ì ¸ì˜¨ ê°’ìœ¼ë¡œ ê°±ì‹ 

/* todo ê°ì²´ë¥¼ ì…ë ¥ë°›ì•„, ê¸°ì¡´ todolistì— ë”í•¨ */
export const addTodo = (payload) => {
  return {
    type: ADD_TODO,
    payload,
  };
};

/* todoì˜ idë¥¼ ì…ë ¥ë°›ì•„, ì¼ì¹˜í•˜ëŠ” todolistë¥¼ ì‚­ì œ */
export const removeTodo = (payload) => {
  return {
    type: REMOVE_TODO,
    payload,
  };
};

/* todoì˜ idë¥¼ ì…ë ¥ë°›ì•„, ì¼ì¹˜í•˜ëŠ” todo ì•„ì´í…œì˜ isDoneì„ ë°˜ëŒ€ë¡œ ë³€ê²½ */
export const switchTodo = (payload) => {
  return {
    type: SWITCH_TODO,
    payload,
  };
};

/* ì´ˆê¸°í™” ë©”ì„œë“œ, ì¦‰ ì™¸ë¶€ DBë¡œ ë¶€í„° ê°€ì ¸ì˜¨ todoì˜ <List> */
export const initialization = (payload) => {
  return {
    type: INITIALIZATION,
    payload,
  };
};

// initial states
const initialState = [];

// reducers
const todos = (state = initialState, action) => {
  switch (action.type) {
    case INITIALIZATION:
      return action.payload;

    case ADD_TODO: // ê¸°ì¡´ì˜ ë°°ì—´ì— ì…ë ¥ë°›ì€ ê°ì²´ë¥¼ ë”í•¨
      return [...state, action.payload];

    case REMOVE_TODO: // ê¸°ì¡´ì˜ ë°°ì—´ì—ì„œ ì…ë ¥ë°›ì€ idì˜ ê°ì²´ë¥¼ ì œê±°(filter)
      return state.filter((item) => item.id !== action.payload);

    case SWITCH_TODO: // ê¸°ì¡´ì˜ ë°°ì—´ì—ì„œ ì…ë ¥ë°›ì€ idì— í•´ë‹¹í•˜ëŠ” ê²ƒë§Œ isDoneì„ ë°˜ëŒ€ë¡œ ë³€ê²½(ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜)
      return state.map((item) => {
        if (item.id === action.payload) {
          return { ...item, isDone: !item.isDone };
        } else {
          return item;
        }
      });
    default:
      return state;
  }
};

// export
export default todos;
```

<br>

## 3.2 TodoList ì»´í¬ë„ŒíŠ¸ ë³€ê²½

### 3.2.1 ë°ì´í„° ì´ˆê¸°í™”, ì¡°íšŒ ë³€ê²½

```jsx
import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import { StyledDiv, StyledTodoListHeader, StyledTodoListBox } from "./styles";
import Todo from "../Todo";
import axios from "axios";
import { initialization } from "../../modules/todos";

/* ì»´í¬ë„ŒíŠ¸ ê°œìš” : ë©”ì¸ > TODOLIST. í•  ì¼ì˜ ëª©ë¡ì„ ê°€ì§€ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ */
function TodoList({ isActive }) {
  const dispatch = useDispatch();

  useEffect(() => {
    const getTodos = async () => {
      try {
        const { data } = await axios.get("http://localhost:4000/todos");
        dispatch(initialization(data));
      } catch (error) {
        console.error(error);
      }
    };

    getTodos();
  }, []);

  const todos = useSelector((state) => state.todos);

  return (
    <StyledDiv>
      <StyledTodoListHeader>
        {isActive ? "í•´ì•¼ í•  ì¼ â›±" : "ì™„ë£Œí•œ ì¼ âœ…"}
      </StyledTodoListHeader>
      <StyledTodoListBox>
        {todos
          .filter((item) => item.isDone === !isActive)
          .map((item) => {
            return <Todo key={item.id} todo={item} isActive={isActive} />;
          })}
      </StyledTodoListBox>
    </StyledDiv>
  );
}

export default TodoList;
```

<br>

### 3.2.2 switch, delete ë³€ê²½

```jsx
import React from "react";
import { useDispatch } from "react-redux";
import HeightBox from "../common/HeightBox";
import { removeTodo, switchTodo } from "../../modules/todos";
import { useNavigate } from "react-router-dom";
import {
  StyledDiv,
  StyledTitle,
  StyledContents,
  TodoButton,
  FlexButtonBox,
  LinkedP,
  FlexTitleBox,
} from "./styles";
import axios from "axios";

/* ë©”ì¸ > TODOLIST > TODO. í•  ì¼ì˜ ë‹¨ìœ„ ì»´í¬ë„ŒíŠ¸ */
function Todo({ todo, isActive }) {
  // ì‚­ì œ í™•ì¸ ìš© ë©”ì‹œì§€ ê´€ë¦¬
  const CONFIRM_MESSAGE = `[ì‚­ì œ í™•ì¸]\n\n"${todo.title}" í•­ëª©ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œë¥¼ ì›ì¹˜ ì•Šìœ¼ì‹œë©´ [ì·¨ì†Œ] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`;

  // hooks
  const dispatch = useDispatch();
  const navigate = useNavigate();

  // ì™„ë£Œ, ì·¨ì†Œë¥¼ handlingí•˜ëŠ” í•¨ìˆ˜
  const handleSwitchButton = async () => {
    // ì„œë²„ í†µì‹  ë¨¼ì €!
    try {
      await axios.patch(`http://localhost:4000/todos/${todo.id}`, {
        isDone: !todo.isDone,
      });
      dispatch(switchTodo(todo.id));
    } catch (error) {
      alert("ì„œë²„ í†µì‹  ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    }
  };

  // [ì‚­ì œ] ë²„íŠ¼ ì„ íƒ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜(userì˜ confirmation í•„ìš”)
  const handleRemoveButton = async () => {
    if (window.confirm(CONFIRM_MESSAGE)) {
      try {
        // ì„œë²„ í†µì‹  ë¨¼ì €!!
        await axios.delete(`http://localhost:4000/todos/${todo.id}`);
        dispatch(removeTodo(todo.id));
      } catch (error) {
        alert("ì„œë²„ í†µì‹  ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        console.error(error);
      }
    }
  };

  // [ìƒì„¸ë³´ê¸°]ë¥¼ ì„ íƒí•˜ëŠ” ê²½ìš° ì´ë™í•˜ëŠ” í•¨ìˆ˜
  const handleDetailPageLinkClick = () => {
    navigate(`/${todo.id}`);
  };

  return (
    <StyledDiv>
      <FlexTitleBox>
        <StyledTitle>{todo.title}</StyledTitle>
        <LinkedP onClick={handleDetailPageLinkClick}>[ìƒì„¸ë³´ê¸°]</LinkedP>
      </FlexTitleBox>
      <HeightBox height={10} />
      <StyledContents>{todo.contents}</StyledContents>
      <HeightBox height={20} />
      <FlexButtonBox>
        <TodoButton onClick={handleSwitchButton}>
          {isActive ? "ì™„ë£Œ" : "ì·¨ì†Œ"}
        </TodoButton>
        <TodoButton onClick={handleRemoveButton}>ì‚­ì œ</TodoButton>
      </FlexButtonBox>
    </StyledDiv>
  );
}

export default Todo;
```

<br>

### 3.2.3 Input ì»´í¬ë„ŒíŠ¸ ë³€ê²½

```jsx
import React, { useState } from "react";
import LabledInput from "../common/LabledInput";
import HeightBox from "../common/HeightBox";
import { StyledButton } from "./styles";
import { FlexDiv } from "./styles";
import RightMarginBox from "../common/RightMarginBox";
import "./styles";
import { StyledDiv } from "./styles";
import { useDispatch, useSelector } from "react-redux";
import { v4 as uuidv4 } from "uuid";
import { addTodo } from "../../modules/todos";
import axios from "axios";

/* Todo ë©”ì¸ í˜ì´ì§€ì—ì„œ ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ëŠ” ì˜ì—­ */
function Input() {
  const dispatch = useDispatch();

  // useSelectorë¥¼ í†µí•œ, storeì˜ ê°’ ì ‘ê·¼
  const todos = useSelector((state) => state.todos);

  // ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•  state 2ê°œ(ì œëª©, ë‚´ìš©) ì •ì˜
  const [title, setTitle] = useState("");
  const [contents, setContents] = useState("");

  // ì—ëŸ¬ ë©”ì‹œì§€ ë°œìƒ í•¨ìˆ˜
  const getErrorMsg = (errorCode, params) => {
    switch (errorCode) {
      case "01":
        return alert(
          `[í•„ìˆ˜ ì…ë ¥ ê°’ ê²€ì¦ ì‹¤íŒ¨ ì•ˆë‚´]\n\nì œëª©ê³¼ ë‚´ìš©ì€ ëª¨ë‘ ì…ë ¥ë¼ì•¼ í•©ë‹ˆë‹¤. ì…ë ¥ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”.\nì…ë ¥ëœ ê°’(ì œëª© : '${params.title}', ë‚´ìš© : '${params.contents}')`
        );
      case "02":
        return alert(
          `[ë‚´ìš© ì¤‘ë³µ ì•ˆë‚´]\n\nì…ë ¥í•˜ì‹  ì œëª©('${params.title}')ë° ë‚´ìš©('${params.contents}')ê³¼ ì¼ì¹˜í•˜ëŠ” TODOëŠ” ì´ë¯¸ TODO LISTì— ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\nê¸° ë“±ë¡í•œ TODO ITEMì˜ ìˆ˜ì •ì„ ì›í•˜ì‹œë©´ í•´ë‹¹ ì•„ì´í…œì˜ [ìƒì„¸ë³´ê¸°]-[ìˆ˜ì •]ì„ ì´ìš©í•´ì£¼ì„¸ìš”.`
        );
      default:
        return `ì‹œìŠ¤í…œ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ê³ ê°ì„¼í„°ë¡œ ì—°ë½ì£¼ì„¸ìš”.`;
    }
  };

  // titleì˜ ë³€ê²½ì„ ê°ì§€í•˜ëŠ” í•¨ìˆ˜
  const handleTitleChange = (event) => {
    setTitle(event.target.value);
  };

  // contentsì˜ ë³€ê²½ì„ ê°ì§€í•˜ëŠ” í•¨ìˆ˜
  const handleContentsChange = (event) => {
    setContents(event.target.value);
  };

  // form íƒœê·¸ ë‚´ë¶€ì—ì„œì˜ submitì´ ì‹¤í–‰ëœ ê²½ìš° í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
  const handleSubmitButtonClick = async (event) => {
    // submitì˜ ê³ ìœ  ê¸°ëŠ¥ì¸, ìƒˆë¡œê³ ì¹¨(refresh)ì„ ë§‰ì•„ì£¼ëŠ” ì—­í•¨
    event.preventDefault();

    // ì œëª©ê³¼ ë‚´ìš©ì´ ëª¨ë‘ ì¡´ì¬í•´ì•¼ë§Œ ì •ìƒì²˜ë¦¬(í•˜ë‚˜ë¼ë„ ì—†ëŠ” ê²½ìš° ì˜¤ë¥˜ ë°œìƒ)
    // "01" : í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦ ì‹¤íŒ¨ ì•ˆë‚´
    if (!title || !contents) {
      return getErrorMsg("01", { title, contents });
    }

    // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” todo í•­ëª©ì´ë©´ ì˜¤ë¥˜
    const validationArr = todos.filter(
      (item) => item.title === title && item.contents === contents
    );

    // "02" : ë‚´ìš© ì¤‘ë³µ ì•ˆë‚´
    if (validationArr.length > 0) {
      return getErrorMsg("02", { title, contents });
    }

    // ì¶”ê°€í•˜ë ¤ëŠ” todoë¥¼ newTodoë¼ëŠ” ê°ì²´ë¡œ ìƒˆë¡œ ë§Œë“¦
    const newTodo = {
      title,
      contents,
      isDone: false,
    };

    try {
      const resposne = await axios.post("http://localhost:4000/todos", newTodo);
      // ì„œë²„ì—ì„œ ë°›ì€ idë¥¼ ì¶”ê°€
      const newId = resposne.data.id;
      // todoë¥¼ ì¶”ê°€í•˜ëŠ” reducer í˜¸ì¶œ
      // ì¸ì : payload
      dispatch(addTodo({ ...newTodo, id: newId }));
      // state ë‘ ê°œë¥¼ ì´ˆê¸°í™”
      setTitle("");
      setContents("");
    } catch (error) {
      alert("ì„œë²„ í†µì‹  ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      console.error(error);
    }
  };

  return (
    <StyledDiv>
      <form onSubmit={handleSubmitButtonClick}>
        <FlexDiv>
          <RightMarginBox margin={10}>
            <LabledInput
              id="title"
              label="ì œëª©"
              placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
              value={title}
              onChange={handleTitleChange}
            />
            <HeightBox height={10} />
            <LabledInput
              id="contents"
              label="ë‚´ìš©"
              placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."
              value={contents}
              onChange={handleContentsChange}
            />
          </RightMarginBox>
          <StyledButton type="submit">ì œì¶œ</StyledButton>
        </FlexDiv>
      </form>
    </StyledDiv>
  );
}

export default Input;
```

ì¼ë°˜ì ìœ¼ë¡œëŠ” ì„œë²„ê°€ idë¥¼ ìƒì„±í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°˜í™˜í•´ì£¼ëŠ” ë°©ì‹ì´ ë” ì•ˆì „í•˜ê³  ì¼ê´€ì„±ì´ ìˆë‹¤.

<br>
