---
title: "[Next.js] Server ActionμΌλ΅ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„ λ°μ΄ν„° μ²λ¦¬ κ°„μ†ν™”ν•κΈ°(μ΅°κΈ λ” κ³µλ¶€ν•κΈ°)"
categories: [Next.js]
toc_label: Contents
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "counts"
---

<br>

# 1. μ„λ²„ μ•΅μ… κ°μ”

## 1.1 μ„λ²„ μ•΅μ…μ κ°λ…

> μ„λ²„ μ•΅μ…μ€ Next.js 13.4μ—μ„ λ„μ…λ κΈ°λ¥μΌλ΅, ν΄λΌμ΄μ–ΈνΈμ—μ„ λ°μƒν• μ΄λ²¤νΈλ‚ μ”μ²­μ„ **μ„λ²„μ—μ„ μ²λ¦¬**ν•λ” λΉ„λ™κΈ° ν•¨μμ΄λ‹¤.

- μ„λ²„μ—μ„ λ°μ΄ν„°λ² μ΄μ¤ μ‘μ—…, νμΌ μ‹μ¤ν… μ ‘κ·Ό λ“± λ³µμ΅ν• μ„λ²„ λ΅μ§μ„ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‰½κ² μ‹¤ν–‰ν•  μ μλ‹¤.
- ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν μ„λ²„ μ•΅μ…μ„ νΈμ¶ν•κ³ , μ„λ²„κ°€ λ°ν™ν• λ°μ΄ν„°λ¥Ό λ°›λ” ν•νƒλ΅ λ™μ‘ν•λ‹¤.

<br>

## 1.2 μ„λ²„ μ•΅μ…μ μ‘λ™ μ›λ¦¬

1. ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„ μ•΅μ… νΈμ¶: ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈμ—μ„ μ§μ ‘ μ„λ²„ μ•΅μ…μ„ νΈμ¶ν•λ‹¤.
2. μ„λ²„μ—μ„ μ•΅μ… μ‹¤ν–‰: μ„λ²„λ” μ•΅μ…μ„ μ²λ¦¬ν•μ—¬ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ‹¤ν–‰ν•λ‹¤.
3. μ„λ²„μ—μ„ κ²°κ³Ό λ°ν™ λ° UI μ—…λ°μ΄νΈ: μ„λ²„λ” μ²λ¦¬ κ²°κ³Όλ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ λ°ν™ν•κ³ , UIκ°€ μ—…λ°μ΄νΈλλ‹¤.γ„΄

<br>

## 1.3 μ„λ²„ μ•΅μ…μ μ¥μ 

> μ„λ²„ μ‚¬μ΄λ“ λ΅μ§μ λ¶„λ¦¬

- μ„λ²„ μ•΅μ…μ€ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ„λ²„μ—μ„ μ²λ¦¬ν•κ³ , ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν λ°μ΄ν„°λ¥Ό μ”μ²­ν•λ” λ°©μ‹μ΄λ‹¤.
- μ΄λ¥Ό ν†µν•΄ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ μ—­ν• μ„ λ…ν™•ν κµ¬λ¶„ν•  μ μμ–΄, μ½”λ“κ°€ λ” κΉ”λ”ν•κ³  μ μ§€λ³΄μκ°€ μ©μ΄ν•΄μ§„λ‹¤.

<br>

> μ„±λ¥ μµμ ν™”

- μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•κ³  μ‘λ‹µμ„ λ³΄λ‚΄λ” λ°©μ‹μ€ λ„¤νΈμ›ν¬ μ”μ²­ νμλ¥Ό μ¤„μ΄κ³  λ°μ΄ν„° μ²λ¦¬ λ¶€λ‹΄μ„ μ„λ²„μ— λ§΅κΈ΄λ‹¤
- μ΄λ” μ΄κΈ° λ΅λ”© μ‹κ°„μ„ λ‹¨μ¶•μ‹ν‚¤κ³  ν΄λΌμ΄μ–ΈνΈ μ„±λ¥μ„ κ°μ„ ν•λ” λ° λ„μ›€μ΄ λλ‹¤.

<br>

> λ³΄μ• κ°•ν™”

- μ„λ²„ μ•΅μ…μ€ μ„λ²„μ—μ„ λ―Όκ°ν• λ΅μ§μ΄λ‚ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•λ―€λ΅, ν΄λΌμ΄μ–ΈνΈμ—μ„ μ§μ ‘μ μΌλ΅ μ¤‘μ”ν• μ •λ³΄λ¥Ό λ‹¤λ£¨μ§€ μ•κ² λλ‹¤.
- μ„λ²„ μ‚¬μ΄λ“μ—μ„λ§ λ°μ΄ν„°κ°€ μ²λ¦¬λμ–΄ λ³΄μ•μƒ λ” μ•μ „ν• ν™κ²½μ„ μ κ³µν•λ‹¤.

<br>

## 1.4 μ„λ²„ μ•΅μ…μ ν™μ©

> νΌ μ²λ¦¬

- ν΄λΌμ΄μ–ΈνΈμ—μ„ νΌμ„ μ μ¶ν•λ©΄ μ„λ²„ μ•΅μ…μ„ ν†µν•΄ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•κ±°λ‚ νμΌμ„ μ—…λ΅λ“
- ex: νμ› κ°€μ…, μ£Όλ¬Έ μ²λ¦¬.

<br>

> ν΄λΌμ΄μ–ΈνΈμ—μ„ λ°μ΄ν„°λ¥Ό κ°€μ Έμ¤λ” λ€μ‹  μ„λ²„μ—μ„ λ°μ΄ν„° μ²λ¦¬ ν›„ μ „λ‹¬

- λ°μ΄ν„°λ¥Ό μ„λ²„μ—μ„ μ§μ ‘ μ²λ¦¬ν•κ³  ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬
- ex: μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§(SSR), μ΄κΈ° νμ΄μ§€ λ΅λ”©

<br>

> λ³΄μ•μ΄ μ¤‘μ”ν• μ‘μ—… μ²λ¦¬

- ν΄λΌμ΄μ–ΈνΈμ—μ„ λ―Όκ°ν• μ •λ³΄ μ²λ¦¬ μ—†μ΄ μ„λ²„μ—μ„λ§ μ²λ¦¬ν•κ³  κ²°κ³Όλ§ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬. (ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν κ²°κ³Όλ¥Ό λ°›λ”λ‹¤.)
- ex: λ΅κ·ΈμΈ, κ²°μ  μ²λ¦¬

<br>

## 1.4 λ°μ΄ν„° ν¨μΉ­ vs μ„λ²„ μ•΅μ…

- λ°μ΄ν„° ν¨μΉ­
  - ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—μ„ λ°μ΄ν„°λ§ μ”μ²­ν•μ—¬ κ°€μ Έμ¨λ‹¤.
  - μ£Όλ΅ `GET` μ”μ²­μ„ μ‚¬μ©ν•μ—¬ λ°μ΄ν„°λ¥Ό μ½κΈ° μ „μ©μΌλ΅ κ°€μ Έμ¤λ” λ° μ‚¬μ©λλ‹¤.
- μ„λ²„ μ•΅μ…
  - μ„λ²„μ—μ„ λ΅μ§ μ²λ¦¬ ν›„ κ²°κ³Όλ¥Ό ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬ν•λ‹¤.
  - `POST`, `PUT`, `DELETE` λ“±μ„ μ‚¬μ©ν•μ—¬ λ°μ΄ν„° λ³€κ²½ μ‘μ—…μ„ μ²λ¦¬ν•λ‹¤.

π’΅ λ°μ΄ν„° ν¨μΉ­μ€ λ°μ΄ν„°λ¥Ό μ½κΈ° μ„ν•΄ ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—μ„ μ”μ²­ν•λ” λ°©μ‹μ΄κ³ , μ„λ²„ μ•΅μ…μ€ μ„λ²„μ—μ„ λ΅μ§μ„ μ²λ¦¬ν•κ³  λ°μ΄ν„°λ¥Ό λ³€κ²½ν•λ” μ‘μ—…μ„ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬ν•λ” λ°©μ‹μ΄λ‹¤.<br>
β οΈ `GET`μ”μ²­μ€ μ„λ²„ μ•΅μ…μ—μ„ μ‚¬μ©ν•  μ μ—†λ‹¤! `GET` μ”μ²­μ€ λ‹¨μν• λ°μ΄ν„° μ΅°νλ¥Ό μ„ν•΄ μ£Όλ΅ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‚¬μ©λκ³ , Next.js μ„λ²„ μ•΅μ…μ—μ„λ” `POST`, `PUT`, `DELETE`μ™€ κ°™μ€ λ°μ΄ν„° λ³€κ²½ μ‘μ—…λ§ μ²λ¦¬ν•  μ μκΈ° λ•λ¬Έμ΄λ‹¤.

<br><br>

# 2. μ„λ²„ μ•΅μ… μ‚¬μ©ν•κΈ°

μ„λ²„ μ•΅μ…μ„ μ‚¬μ©ν•λ ¤λ©΄, λ¨Όμ € μ„λ²„ μ•΅μ…μ„ μ •μν•κ³ , κ·Έ ν›„ ν΄λΌμ΄μ–ΈνΈμ—μ„ νΈμ¶ν•μ—¬ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•λ©΄ λλ‹¤.

## 2.1 μ„λ²„ μ•΅μ… μ •μν•κΈ°

> `"use server"`λΌλ” μ§€μ‹μ–΄λ¥Ό ν•¨μ μµμƒλ‹¨μ— μ¶”κ°€ν•λ©΄ ν•΄λ‹Ή ν•¨μκ°€ μ„λ²„μ—μ„ μ‹¤ν–‰λλ„λ΅ ν•  μ μλ‹¤.

```tsx
// app/action/todo-actions.ts
"use server";

import { Todo } from "../types/todo-types";

const baseURL = process.env.NEXT_PUBLIC_SERVER_URL;

export const addTodo = async (todo: Todo) => {
  const response = await fetch(`${baseURL}/todos`, {
    method: "post",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(todo),
  });
  const data = await response.json();

  return data;
};
```

- μ„ μ½”λ“μ—μ„ `addTodo`λΌλ” ν•¨μκ°€ μ„λ²„μ—μ„ μ‹¤ν–‰λλ©°, ν•  μΌμ„ `POST` λ°©μ‹μΌλ΅ μ„λ²„μ— μ „μ†΅ν•κ³  κ²°κ³Όλ¥Ό λ°ν™ν•λ‹¤.
- ν΄λΌμ΄μ–ΈνΈμ—μ„ μ΄ μ„λ²„ μ•΅μ…μ„ νΈμ¶ν•μ—¬ μ‚¬μ©μκ°€ λ¦¬μ¤νΈλ¥Ό κ°€μ Έμ¬ μ μλ‹¤.

<br>

## 2.2 ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„ μ•΅μ… νΈμ¶ν•κΈ°

> ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„ μ•΅μ…μ„ νΈμ¶ν•κΈ°λ§ ν•κ³ , κ·Έμ— λ€ν• μ‘λ‹µμ„ λ°›μ•„ μ²λ¦¬ν•λ‹¤.

mutationμ„ μ‚¬μ©ν•μ—¬ μ„λ²„ μ•΅μ…(addTodo)μ„ ν΄λΌμ΄μ–ΈνΈμ—μ„ νΈμ¶ν•΄μ£Όμ—λ‹¤.

```tsx
export const useAddTodoMutation = () => {
  const queryClient = useQueryClient();

  // Add Todo Mutation
  const { mutate: addTodoMutate } = useMutation({
    mutationFn: addTodo,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: [QUERY_KEYS.TODOS] });
      alert("μ¶”κ°€ μ™„λ£!");
    },
    onError: (error) => {
      console.error("μ¶”κ°€ μ‹¤ν¨:", error);
      alert("μ¶”κ°€ μ‹¤ν¨. λ‹¤μ‹ μ‹λ„ν•΄ μ£Όμ„Έμ”.");
    },
  });

  return { addTodoMutate };
};
```

<br>

> μ΄μ  `addTodoMutate`λ¥Ό ν†µν•΄ μ„λ²„ μ•΅μ…μ„ νΈμ¶ν•  μ μλ‹¤.

```tsx
"use client";

import { useAddTodoMutation } from "@/app/hooks/query/useTodosMutation";
import { useId } from "react";

const TodoForm = () => {
  // μ¶”κ°€
  const { addTodoMutate } = useAddTodoMutation();

  const handleOnSubmit = (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();

    const form = e.currentTarget;
    const formData = new FormData(e.currentTarget);
    const title = formData.get("title") as string;
    const content = formData.get("content") as string;

    const nextTodo = {
      id: crypto.randomUUID(),
      title,
      content,
      isDone: false,
      deadline: new Date().toLocaleDateString(),
    };

    addTodoMutate(nextTodo);

    form.reset();
  };

  const titleId = useId();
  const contentId = useId();

  return (
    <div>
      <form onSubmit={handleOnSubmit}>
        <label htmlFor={titleId}>Title</label>
        <input type="text" id={titleId} name="title" required />
        <label htmlFor={contentId}>content</label>
        <input type="text" id={contentId} name="content" required />
        <button type="submit">μ¶”κ°€ν•κΈ°</button>
      </form>
    </div>
  );
};

export default TodoForm;
```

> μ„λ²„ μ•΅μ…μ—μ„ μ‚­μ  μ‘μ—…μ„ μ‹¤ν–‰ν• ν›„, λ‹¤μκ³Ό κ°™μ€ λ°μ΄ν„°κ°€ λ°ν™λμ—λ‹¤!

- κ·Έλ¦¬κ³  `DELETE`, `PATCH`μ™€ κ°™μ€ μƒνƒ μ½”λ“λ¥Ό λ°ν™ν•μ§€ μ•μ•λ‹¤. (`GET`, `POST` λ§ λ°ν™)

![](/assets/images/2024/2024-10-03-20-44-59.png)

<br>

- β“ μ„λ²„ μ•΅μ…μ—μ„ Request Methodμ— `GET`, `POST`λ§ λ°ν™λκ³  `DELETE`, `PATCH`μ λ” λ°ν™λμ§€ μ•λ” μ΄μ λ¥Ό μ°Ύμ•„λ΄¤λ”λ‹,
  - μ£Όλ΅ μ„λ²„ κµ¬μ„±, ν΄λΌμ΄μ–ΈνΈμ μ”μ²­ λ°©μ‹, λλ” ν”„λ μ„μ›ν¬μ μ ν•μ— μν•΄ λ°μƒν•λ‹¤κ³  ν•λ‹¤.
  - (GPTν•ν… λ¬Όμ–΄λ³Έ κ²ƒμ΄λ―€λ΅ ν™•μ‹¤ν•μ§€ μ•λ‹¤.. λ‹¤λ¥Έ λ¶„λ“¤ν•ν… λ¬Όμ–΄λ΄μ•Όκ² λ‹¤. μ§„μ§ μ™ κ·Έλ°κ±°μ§€?)

<br>

> λ°λ©΄, μ„λ²„ μ•΅μ…μ„ μ‚¬μ©ν•μ§€ μ•μ•μ„ κ²½μ° `GET`, `DELETE`, `PATCH`μ™€ κ°™μ€ μƒνƒ μ½”λ“λ§ λ°ν™μ΄ λμ—λ‹¤.

μ‚­μ λ ν•­λ©μ μ •λ³΄λ” **μ‘λ‹µ(response)**μ— ν¬ν•¨λμ§€ μ•μ•λ‹¤.

![](/assets/images/2024/2024-10-03-22-14-35.png)![](/assets/images/2024/2024-10-03-22-14-46.png)

<br><br>

# 3. ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ΅μ§μ„ κ°™μ€ μ»΄ν¬λ„νΈ μ•μ—μ„ μ²λ¦¬ν•κΈ°

μ„λ²„ λ΅μ§μ„ ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ μ•μ—μ„ ν•¨κ» μ‘μ„±ν•  μ μλ‹¤.

## 3.1 λ™μ‘ μ›λ¦¬

> `Server Actions`μ„ μ‚¬μ©ν•λ©΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ action μ†μ„±μΌλ΅ μ„λ²„ μ½”λ“κ°€ ν¬ν•¨λ ν•¨μλ¥Ό νΈμ¶ν•  μ μλ‹¤.

- μ΄λ• μ„λ²„ μ½”λ“λ” μλ™μΌλ΅ μ„λ²„μ—μ„ μ‹¤ν–‰λλ‹¤.
- μ¦‰, ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈμ—μ„ μ„λ²„ μ½”λ“λ¥Ό μ§μ ‘ μ‘μ„±ν•κ³ , μ΄λ¥Ό μ„λ²„μ—μ„λ§ μ‹¤ν–‰λλ„λ΅ ν•  μ μλ‹¤λ” κ²ƒμ΄λ‹¤.

<br>

> κΈ°μ΅΄ λ°©μ‹ (ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¶„λ¦¬)

- κΈ°μ΅΄ λ°©μ‹μ—μ„λ” ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈμ—μ„ νΌμ„ μ μ¶ν•λ©΄, μ„λ²„λ΅ API μ”μ²­μ„ λ³΄λ‚΄μ„ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•λ‹¤.
- μλ¥Ό λ“¤μ–΄, ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„μ— `POST` μ”μ²­μ„ λ³΄λ‚΄μ„ λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ‹¤κ³  κ°€μ •ν•΄λ³΄μ.

1. ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈμ—μ„ μ„λ²„ APIλ΅ μ”μ²­
2. μ„λ²„μ—μ„ μ”μ²­μ„ λ°›μ•„ DBμ— μ €μ¥

π’΅ ν•μ§€λ§, μ„λ²„ μ•΅μ…μ„ μ‚¬μ©ν•λ©΄ λ³„λ„λ΅ APIλ¥Ό μ‘μ„±ν•  ν•„μ” μ—†μ΄, ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„ λ΅μ§μ„ λ°”λ΅ μ²λ¦¬ν•  μ μλ‹¤.

<br>

> μ„λ²„ μ•΅μ…μ„ μ‚¬μ©ν•μ—¬ νΌ μ μ¶μ„ ν†µν•΄ μ„λ²„μ—μ„ DBμ— λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ” μμ‹

```tsx
// app/write2/page.js
import { connectDB } from "@/util/database"; // DB μ—°κ²° μ ν‹Έ ν•¨μ

export default async function Write2() {
  // μ„λ²„ μ•΅μ… ν•¨μ (μ„λ²„ μ½”λ“)
  async function handleSubmit(formData) {
    "use server"; // μ„λ²„ μ½”λ“μ„μ„ ν‘μ‹
    const db = (await connectDB).db("forum");
    await db
      .collection("post_test")
      .insertOne({ title: formData.get("post1") });
  }

  // νΌ κµ¬μ„±
  return (
    <form action={handleSubmit}>
      <input type="text" name="post1" />
      <button type="submit">Submit</button>
    </form>
  );
}
```

- ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ: UIμ™€ μ‚¬μ©μμ μ…λ ¥μ„ λ°›λ” μ—­ν• μ„ ν•λ‹¤.
- μ„λ²„ μ½”λ“: νΌ μ μ¶ μ‹ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•κ³  DBμ— μ €μ¥ν•λ” μ‘μ—…μ„ μ„λ²„μ—μ„λ§ μ‹¤ν–‰ν•λ‹¤.

π’΅ μ΄λ ‡κ² μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ΅μ§μ΄ κ°™μ€ νμΌ μ•μ—μ„ μ²λ¦¬ν•  μ μλ‹¤. μ¦‰, λ³„λ„λ΅ API νμΌμ„ μ‘μ„±ν•  ν•„μ” μ—†μ΄, μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ΅μ§μ„ ν•λ‚μ μ»΄ν¬λ„νΈμ—μ„ λ™μ‹μ— κ΄€λ¦¬ν•  μ μλ” κ²ƒμ΄λ‹¤.

<br><br>

# μ°Έμ΅°

- [[nextjs] Server Action](https://velog.io/@jjunyjjuny/nextjs-Server-Action)
- [Next.jsμ Server actions κΈ°λ¥](https://codingapple.com/unit/nextjs-server-actions/)

<br>
