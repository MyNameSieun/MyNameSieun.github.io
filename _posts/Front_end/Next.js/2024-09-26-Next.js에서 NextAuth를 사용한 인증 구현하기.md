---
title: "[Next.js] Next.js에서 NextAuth를 사용한 인증 구현하기"
toc_label: Contents
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "counts"
---

<br>

[[Next.js에서 NextAuth를 사용한 인증 구현하기 Repo↗️]](https://github.com/MyNameSieun/Nextjs-Authentication)

<br>

# 1. NextAuth 개요

[NextAuth 공식 문서↗️](https://next-auth.js.org/)`
{: .notice}

> NextAuth.js는 Next.js App에 인증 기능을 쉽게 추가할 수 있는 라이브러리이다.

- 백엔드로부터 로그인 이후 `Authentication`등의 정보를 받아와야 한다.
- 그리고 `access token`, `refresh token`등 정보를 별도 공간에 저장하고 관리해야 한다.
- 지금까지 access token을 localStorage에 단순하게 저장 하였지만, 이는 보안 문제가 발생할 수 있다.

> NextAuth의 장점

- 간편한 설정
  - 설정이 간단하여 복잡한 인증 로직 없이도 빠르게 인증 기능을 구현할 수 있다.
- 다양한 Authentication Providers 지원
  - GitHub, Google, Facebook, Twitter 등 다양한 인증 제공자를 사용할 수 있다.
- 세션 관리
  - NextAuth는 사용자 세션을 자동으로 관리해 준다.
  - 세션 상태를 확인하고 쉽게 갱신할 수 있는 기능이 내장되어 있다.
- 보안
  - CSRF 공격 방지, JWT(JSON Web Token) 지원, 사용자 비밀번호 암호화 등 보안 관련 기능을 제공한다.

<br><br>

# 2. NextAuth 사용하기

# 2.1 설치

```shell
yarn add next-auth
```

<br>

## 2.2 NextAuth 설정하기

> NextAuth.js를 설정하기 위해, Next.js의 API 라우트를 생성해야 한다.

`app/api/auth/[...nextauth]/route.ts`에 파일을 생성하여, 다음과 같이 NextAuth 핸들러를 설정하자.

```tsx
import NextAuth from "next-auth";
import CredentialsProvider from "next-auth/providers/credentials";

const handler = NextAuth({
  providers: [
    CredentialsProvider({
      name: "Credentials",
      credentials: {
        id: {
          label: "아이디",
          type: "text",
          placeholder: "아이디를 입력해주세요.",
        },
        password: {
          label: "비밀번호",
          type: "password",
          placeholder: "비밀번호를 입력해주세요.",
        },
      },
      async authorize(credentials, req) {
        // 로그인 요청을 처리하는 부분
        const res = await fetch("http://moneyfulpublicpolicy.co.kr/login", {
          method: "POST",
          body: JSON.stringify(credentials),
          headers: {
            "Content-Type": "application/json",
          },
        });

        const user = await res.json();

        if (res.ok && user) {
          return user; // 인증 성공 시 사용자 정보 반환
        }
        return null; // 인증 실패 시 null 반환
      },
    }),
  ],
  pages: {
    signIn: "/signin", // 사용자 정의 로그인 페이지 (커스터마이징)
  },
});

export { handler as GET, handler as POST };
```

- CredentialsProvider: 사용자가 입력한 아이디와 비밀번호로 인증을 처리한다.
- authorize(): 사용자로부터 받은 자격 증명을 기반으로 API에 요청을 보내고, 인증이 성공하면 사용자 정보를 반환한다.

<br>

## 2.3 Session Provider 설정

> 인증 세션을 관리하기 위해 SessionProvider를 설정해야 한다.

`app/provider.tsx` 파일을 생성하자.

```tsx
"use client";

import { SessionProvider } from "next-auth/react";

const Provider = ({ children }: { children: React.ReactNode }) => {
  return <SessionProvider>{children}</SessionProvider>;
};

export default Provider;
```

- `SessionProvider`: 애플리케이션의 모든 컴포넌트가 인증 세션에 접근할 수 있도록 한다.

<br>

# 2.4 NavBar 컴포넌트 생성

> 사용자의 인증 상태에 따라 로그인 또는 로그아웃 버튼을 표시하는 NavBar 컴포넌트를 생성하자.

`app/components/layouts/NavBar.tsx` 파일을 만들자.

```tsx
"use client";

import { signIn, signOut, useSession } from "next-auth/react";

const NavBar = () => {
  const session = useSession(); // 현재 세션 정보 가져오기
  const isLoggedIn = session.status === "authenticated"; // 로그인 상태 확인

  return (
    <nav className="flex justify-between mb-4">
      <section>Home</section>
      <section>
        {isLoggedIn ? (
          <button onClick={() => signOut()}>로그아웃</button> // 로그아웃 버튼
        ) : (
          <button onClick={() => signIn()}>로그인</button> // 로그인 버튼
        )}
      </section>
    </nav>
  );
};

export default NavBar;
```

<br>

## 2.5 Layout 설정

> Next.js 애플리케이션의 레이아웃을 설정하는 `app/layout.tsx` 파일이다.

`SessionProvider`로 감싸주어 모든 자식 컴포넌트에서 인증 상태에 접근할 수 있도록 하자.

```tsx
import type { Metadata } from "next";
import NavBar from "./components/layouts/NavBar";
import "./index.css";
import Provider from "./provider";

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body>
        <Provider>
          <NavBar />
          {children}
        </Provider>
      </body>
    </html>
  );
}
```

<br>
